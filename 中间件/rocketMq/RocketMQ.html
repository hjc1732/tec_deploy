<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RocketMQ入门 | 技术侦探</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script charset="utf-8" async="async" src="https://s9.cnzz.com/z_stat.php?id=1278232949&amp;web_id=1278232949"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?0b31b4c146bf7126aed5009e1a4a11c8";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="技术并不是我们所追求的目的,而是技术创新世界">
    <meta property="article:modified_time" content="null">
    <meta property="og:title" content="RocketMQ入门">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html">
    <meta name="twitter:title" content="RocketMQ入门">
    <meta name="twitter:url" content="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="小傅哥">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="Java基础">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.ee4e0787.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1718536766705" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1718536766705" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1718536766705" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1718536766705" as="script"><link rel="preload" href="/assets/js/cg-28.js?v=1718536766705" as="script"><link rel="preload" href="/assets/js/cg-1.js?v=1718536766705" as="script"><link rel="preload" href="/assets/js/cg-88.js?v=1718536766705" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.ee4e0787.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1718536766705">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">技术侦探</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/javaSE基础/01_Java入门与开发环境搭建.html" class="nav-link">
  javaSE
</a></li><li class="dropdown-subitem"><a href="/java/javaWeb/01_Web开发基础.html" class="nav-link">
  javaWeb
</a></li><li class="dropdown-subitem"><a href="/java/JUC/1、JUC概述.html" class="nav-link">
  JUC
</a></li><li class="dropdown-subitem"><a href="/java/响应式编程/前置知识.html" class="nav-link">
  响应式编程
</a></li><li class="dropdown-subitem"><a href="/设计模式/概述/概述.html" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/jdbc/01_JDBC.html" class="nav-link">
  jdbc
</a></li><li class="dropdown-subitem"><a href="/db/mysql/Mysql基础/01_MySQL概述.html" class="nav-link">
  mysql
</a></li></ul></li><li class="dropdown-item"><h4>
          补充
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/补充/Retrofit2.html" class="nav-link">
  Retrofit2
</a></li><li class="dropdown-subitem"><a href="/java/补充/rxJava/rxJava.html" class="nav-link">
  rxJava
</a></li><li class="dropdown-subitem"><a href="/java/补充/lua.html" class="nav-link">
  lua
</a></li><li class="dropdown-subitem"><a href="/java/补充/JVM.html" class="nav-link">
  jvm
</a></li><li class="dropdown-subitem"><a href="/java/补充/枚举.html" class="nav-link">
  枚举
</a></li><li class="dropdown-subitem"><a href="/java/补充/线程池.html" class="nav-link">
  线程池
</a></li><li class="dropdown-subitem"><a href="/java/补充/自定义注解.html" class="nav-link">
  自定义注解
</a></li></ul></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端/前端基础/01_HTML.html" class="nav-link">
  前端基础
</a></li><li class="dropdown-subitem"><a href="/前端/vue/01_ECMAScript6入门.html" class="nav-link">
  vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/框架/DDD架构/01-ddd是什么.html" class="nav-link">
  DDD
</a></li><li class="dropdown-item"><!----> <a href="/框架/Mybatis/01_MyBatis快速入门.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><h4>
          Spring全家桶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/框架/Spring全家桶/Spring/01_SpringIOC和DI.html" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringMVC/01_SpringMVC快速入门及解析.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringBoot/01_SpringBoot_入门.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringSecurity/SpringSecurity.html" class="nav-link">
  SpringSecurity
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringCloudAlibaba/Nacos.html" class="nav-link">
  SpringCloudAlibaba
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/中间件/ElasticSearch/ElasticSearch.html" class="nav-link">
  中间件 | 自研轮子
</a></div><div class="nav-item"><a href="/部署/linux/01_Linux_安装.html" class="nav-link">
  部署|运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/实战/商城/项目笔记.html" class="nav-link">
  锋迷铺子
</a></li><li class="dropdown-item"><!----> <a href="/实战/实用工具类/DocUtils.html" class="nav-link">
  实用工具类
</a></li><li class="dropdown-item"><!----> <a href="http://520.hjcwzx.top/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  研究生工作平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/更新日志/更新日志.html" class="nav-link">
  更新日志
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/javaSE基础/01_Java入门与开发环境搭建.html" class="nav-link">
  javaSE
</a></li><li class="dropdown-subitem"><a href="/java/javaWeb/01_Web开发基础.html" class="nav-link">
  javaWeb
</a></li><li class="dropdown-subitem"><a href="/java/JUC/1、JUC概述.html" class="nav-link">
  JUC
</a></li><li class="dropdown-subitem"><a href="/java/响应式编程/前置知识.html" class="nav-link">
  响应式编程
</a></li><li class="dropdown-subitem"><a href="/设计模式/概述/概述.html" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/jdbc/01_JDBC.html" class="nav-link">
  jdbc
</a></li><li class="dropdown-subitem"><a href="/db/mysql/Mysql基础/01_MySQL概述.html" class="nav-link">
  mysql
</a></li></ul></li><li class="dropdown-item"><h4>
          补充
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/补充/Retrofit2.html" class="nav-link">
  Retrofit2
</a></li><li class="dropdown-subitem"><a href="/java/补充/rxJava/rxJava.html" class="nav-link">
  rxJava
</a></li><li class="dropdown-subitem"><a href="/java/补充/lua.html" class="nav-link">
  lua
</a></li><li class="dropdown-subitem"><a href="/java/补充/JVM.html" class="nav-link">
  jvm
</a></li><li class="dropdown-subitem"><a href="/java/补充/枚举.html" class="nav-link">
  枚举
</a></li><li class="dropdown-subitem"><a href="/java/补充/线程池.html" class="nav-link">
  线程池
</a></li><li class="dropdown-subitem"><a href="/java/补充/自定义注解.html" class="nav-link">
  自定义注解
</a></li></ul></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端/前端基础/01_HTML.html" class="nav-link">
  前端基础
</a></li><li class="dropdown-subitem"><a href="/前端/vue/01_ECMAScript6入门.html" class="nav-link">
  vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/框架/DDD架构/01-ddd是什么.html" class="nav-link">
  DDD
</a></li><li class="dropdown-item"><!----> <a href="/框架/Mybatis/01_MyBatis快速入门.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><h4>
          Spring全家桶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/框架/Spring全家桶/Spring/01_SpringIOC和DI.html" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringMVC/01_SpringMVC快速入门及解析.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringBoot/01_SpringBoot_入门.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringSecurity/SpringSecurity.html" class="nav-link">
  SpringSecurity
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringCloudAlibaba/Nacos.html" class="nav-link">
  SpringCloudAlibaba
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/中间件/ElasticSearch/ElasticSearch.html" class="nav-link">
  中间件 | 自研轮子
</a></div><div class="nav-item"><a href="/部署/linux/01_Linux_安装.html" class="nav-link">
  部署|运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/实战/商城/项目笔记.html" class="nav-link">
  锋迷铺子
</a></li><li class="dropdown-item"><!----> <a href="/实战/实用工具类/DocUtils.html" class="nav-link">
  实用工具类
</a></li><li class="dropdown-item"><!----> <a href="http://520.hjcwzx.top/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  研究生工作平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/更新日志/更新日志.html" class="nav-link">
  更新日志
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>中间件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/中间件/ElasticSearch/ElasticSearch.html" class="sidebar-link">Elasticsearch</a></li><li><a href="/中间件/EasyES/Easy-es.html" class="sidebar-link">Easy-Es</a></li><li><a href="/中间件/ELK/使用docker搭建ELK.html" class="sidebar-link">ELK搭建(Docker版本)</a></li><li><a href="/中间件/redis/Redis笔记全.html" class="sidebar-link">Redis</a></li><li><a href="/中间件/redis/布隆过滤器.html" class="sidebar-link">布隆过滤器</a></li><li><a href="/中间件/rocketMq/RocketMQ.html" class="active sidebar-link">RocketMQ入门</a></li><li><a href="/中间件/rocketMq/rocketMq深入.html" class="sidebar-link">RocketMQ深入理解</a></li><li><a href="/中间件/git/笔记.html" class="sidebar-link">Git</a></li><li><a href="/中间件/maven/01_Maven基础.html" class="sidebar-link">Maven基础</a></li><li><a href="/中间件/maven/02_Maven聚合工程.html" class="sidebar-link">Maven聚合工程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>自定义starter</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/中间件/自定义Starter/自定义starter.html" class="sidebar-link">自定义starter</a></li><li><a href="/中间件/自定义Starter/白名单过滤starter.html" class="sidebar-link">白名单过滤</a></li><li><a href="/中间件/自定义Starter/上传中央仓库.html" class="sidebar-link">上传maven中央仓库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ApacheRocketMQ开发者指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/中间件/rocketMq/mq/mq.html" class="sidebar-link">ApacheRocketMQ开发者指南</a></li><li><a href="/中间件/rocketMq/mq/concept.html" class="sidebar-link">基本概念</a></li><li><a href="/中间件/rocketMq/mq/features.html" class="sidebar-link">特性(features)</a></li><li><a href="/中间件/rocketMq/mq/architecture.html" class="sidebar-link">架构设计</a></li><li><a href="/中间件/rocketMq/mq/design.html" class="sidebar-link">设计(design)</a></li><li><a href="/中间件/rocketMq/mq/RocketMQ_Example.html" class="sidebar-link">样例</a></li><li><a href="/中间件/rocketMq/mq/best_practice.html" class="sidebar-link">最佳实践</a></li><li><a href="/中间件/rocketMq/mq/msg_trace/user_guide.html" class="sidebar-link">消息轨迹</a></li><li><a href="/中间件/rocketMq/mq/acl/user_guide.html" class="sidebar-link">权限控制</a></li><li><a href="/中间件/rocketMq/mq/dledger/quick_start.html" class="sidebar-link">Dledger快速搭建</a></li><li><a href="/中间件/rocketMq/mq/dledger/deploy_guide.html" class="sidebar-link">Dledger集群搭建</a></li><li><a href="/中间件/rocketMq/mq/operation.html" class="sidebar-link">运维管理</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h1 id="rocketmq入门"><a href="#rocketmq入门" class="header-anchor">#</a> RocketMQ入门</h1> <h1 id="一-什么是mq"><a href="#一-什么是mq" class="header-anchor">#</a> 一：什么是MQ</h1> <h2 id="_1-1-什么是mq-message-queue-消息队列"><a href="#_1-1-什么是mq-message-queue-消息队列" class="header-anchor">#</a> 1.1：什么是MQ     (Message Queue 消息队列)</h2> <p>mq：是生产者消费者的设计模式</p> <p>生产者：往queue存放消息</p> <p>消息队列：存储消息</p> <p>消费者：消费消息</p> <p><img src="/assets/img/image-20201107095033332.d42948c4.png" alt="image-20201107095033332"></p> <p>​     生成者发送消息到mq，消息有一个主题（消费者可以通过主题取到特定是消息），</p> <p>​    消费者会去mq中主动取特定主题的消息</p> <p>和原始的http请求的不同在于？ 在于异步性</p> <h2 id="_1-2-mq的优势"><a href="#_1-2-mq的优势" class="header-anchor">#</a> 1.2：MQ的优势</h2> <p>优势一：异步处理</p> <blockquote><p>服务之间的调用同步调用，如果下游服务是一个耗时操作，那么会阻塞线程(http)，最终导致触发熔断降级</p> <p>解决办法：使用mq，mq可以实现异步操作</p></blockquote> <p>优势二：应用解耦      A （支付模块）和 B （物流模块）</p> <blockquote><p>系统的耦合性越高，容错性就越低，使用MQ可以达到完全解耦</p></blockquote> <p>优势三：流量削峰</p> <blockquote><p>消息队列可以将大量请求缓存起来，分散到很长一段时间处理，避免请求丢失或者系统被压垮</p></blockquote> <h2 id="_1-3-主流mq对比"><a href="#_1-3-主流mq对比" class="header-anchor">#</a> 1.3：主流MQ对比</h2> <p><strong>面试题</strong></p> <p><strong>常见的MQ产品包括Kafka、ActiveMQ、RabbitMQ、RocketMQ。</strong></p> <table><thead><tr><th>特性</th> <th>ActiveMQ</th> <th>RabbitMQ</th> <th>RocketMQ(阿里)</th> <th>kafka(大数据)</th></tr></thead> <tbody><tr><td>开发语言</td> <td>java</td> <td>erlang</td> <td>java</td> <td>scala</td></tr> <tr><td>单机吞吐量qps</td> <td>万级</td> <td>万级</td> <td>10万级</td> <td>10万级</td></tr> <tr><td>时效性rt</td> <td>ms级</td> <td>us级</td> <td>ms级</td> <td>ms级</td></tr> <tr><td>可用性(高可用)</td> <td>主从架构</td> <td>主从架构</td> <td>分布式架构</td> <td>分布式架构</td></tr></tbody></table> <p>​</p> <p>优劣势总结</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>ActiveMQ
非常成熟，功能强大，在业内大量的公司以及项目中都有应用,偶尔会有较低概率丢失消息,而且现在社区以及国内应用都越来越少，官方社区现在对ActiveMQ 5.x维护越来越少，几个月才发布一个版本而且确实主要是基于解耦和异步来用的，较少在大规模吞吐的场景中使用

RabbitMQ
erlang语言开发，性能极其好，延时很低；
吞吐量到万级，MQ功能比较完备
而且开源提供的管理界面非常棒，用起来很好用
社区相对比较活跃，几乎每个月都发布几个版本分
在国内一些互联网公司近几年用rabbitmq也比较多一些
但是问题也是显而易见的，RabbitMQ确实吞吐量会低一些，这是因为他做的实现机制比较重。
而且erlang开发，国内有几个公司有实力做erlang源码级别的研究和定制？如果说你没这个实力的话，确实偶尔会有一些问题，你很难去看懂源码，你公司对这个东西的掌控很弱，基本职能依赖于开源社区的快速维护和修复bug。
而且rabbitmq集群动态扩展会很麻烦，不过这个我觉得还好。其实主要是erlang语言本身带来的问题。很难读源码，很难定制和掌控。


RocketMQ
接口简单易用，而且毕竟在阿里大规模应用过，有阿里品牌保障
日处理消息上百亿之多，可以做到大规模吞吐，性能也非常好，分布式扩展也很方便，社区维护还可以，可靠性和可用性都是ok的，还可以支撑大规模的topic数量，支持复杂MQ业务场景
而且一个很大的优势在于，阿里出品都是java系的，我们可以自己阅读源码，定制自己公司的MQ，可以掌控
有很多业务特性，如瞬时消息，延迟消息，事务消息等

kafka   (缺少业务相关功能，如延迟消息没有)
kafka的特点其实很明显，就是仅仅提供较少的核心功能，但是提供超高的吞吐量，ms级的延迟，极高的可用性以及可靠性，而且分布式可以任意扩展同时kafka最好是支撑较少的topic数量即可，保证其超高吞吐量
而且kafka唯一的一点劣势是有可能消息重复消费，那么对数据准确性会造成极其轻微的影响，在大数据领域中以及日志采集中，这点轻微影响可以忽略这个特性天然适合大数据实时计算以及日志收集
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_1-4-apache-rocketmq简介"><a href="#_1-4-apache-rocketmq简介" class="header-anchor">#</a> 1.4：Apache RocketMQ简介</h2> <blockquote><p>RocketMQ是阿里巴巴2016年MQ中间件，使用Java语言开发，在阿里内部，RocketMQ承接了例如“双11”等高并发场景的消息流转，能够处理万亿级别的消息。</p></blockquote> <p>官网：http://rocketmq.apache.org/</p> <p>中文文档：https://github.com/apache/rocketmq/tree/master/docs/cn</p> <p>不同版本下载地址：http://rocketmq.apache.org/dowloading/releases/</p> <h1 id="二-rocketmq安装与启动"><a href="#二-rocketmq安装与启动" class="header-anchor">#</a> 二：RocketMQ安装与启动</h1> <blockquote><p>解压即安装</p></blockquote> <p>配置ROCKETMQ_HOME环境变量</p> <p><img src="/assets/img/image-20201109102536152.f2c1397a.png" alt="image-20201109102536152"></p> <h2 id="_2-1-配置并启动nameserver进程"><a href="#_2-1-配置并启动nameserver进程" class="header-anchor">#</a> 2.1：配置并启动nameserver进程</h2> <blockquote><p>Rocketmq：有两类进程分别是 nameserv、broker进程</p></blockquote> <h3 id="_2-1-1-配置nameserver"><a href="#_2-1-1-配置nameserver" class="header-anchor">#</a> 2.1.1：配置nameserver</h3> <p><img src="/assets/img/image-20201109100854184.c9f1cc10.png" alt="image-20201109100854184"></p> <p>没有该文件，则新建</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">listenPort</span><span class="token punctuation">=</span><span class="token value attr-value">9876</span>
<span class="token key attr-name">listenIp</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-1-2-启动nameserver"><a href="#_2-1-2-启动nameserver" class="header-anchor">#</a> 2.1.2：启动nameserver</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>start  mqnamesrv.cmd <span class="token parameter variable">-c</span>  <span class="token punctuation">..</span>/conf/nameserver.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20210223173026698.22b82550.png" alt="image-20210223173026698"></p> <p>常见问题：</p> <p>1当windows 下 Rocketmq Broker异常关闭后，会出现无法启动broker的情况，只需要将C盘 C:\Users\用户 的    store文件夹删除，再进行启动</p> <p>2 maybe your broker machine memory too small        清理一下C盘</p> <blockquote><p>如果服务器性能不够，修改runserver.cmd里面jvm配置   （一般不需要）</p></blockquote> <p><img src="/assets/img/image-20210223173445921.4de447b9.png" alt="image-20210223173445921"></p> <p>nameserver进程启动成功</p> <p><img src="/assets/img/image-20201109101922247.02a6a78f.png" alt="image-20201109101922247"></p> <h2 id="_2-2-配置并启动broker进程"><a href="#_2-2-配置并启动broker进程" class="header-anchor">#</a> 2.2：配置并启动broker进程</h2> <h3 id="_2-2-1-配置broker"><a href="#_2-2-1-配置broker" class="header-anchor">#</a> 2.2.1：配置broker</h3> <p><img src="/assets/img/image-20201109102023742.fead8994.png" alt="image-20201109102023742"></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code>
<span class="token comment">#所属集群名字</span>
<span class="token key attr-name">brokerClusterName</span><span class="token punctuation">=</span><span class="token value attr-value">rocketmq-cluster</span>
<span class="token comment">#broker名字，注意此处不同的配置文件填写的不一样</span>
<span class="token key attr-name">brokerName</span><span class="token punctuation">=</span><span class="token value attr-value">broker-a</span>
<span class="token comment">#0 表示 Master，&gt;0 表示 Slave</span>
<span class="token key attr-name">brokerId</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token comment">#nameServer地址，分号分割【重点】</span>
<span class="token key attr-name">namesrvAddr</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:9876</span>
<span class="token comment">#Broker 对外服务的监听端口</span>
<span class="token key attr-name">listenPort</span><span class="token punctuation">=</span><span class="token value attr-value">10911</span>
<span class="token comment">#Broker监听的ip【重点】</span>
<span class="token key attr-name">brokerIP1</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1</span>

<span class="token comment">#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数</span>
<span class="token key attr-name">defaultTopicQueueNums</span><span class="token punctuation">=</span><span class="token value attr-value">4</span>
<span class="token comment">#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token key attr-name">autoCreateTopicEnable</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token comment">#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token key attr-name">autoCreateSubscriptionGroup</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token comment">#删除文件时间点，默认凌晨 4点</span>
<span class="token key attr-name">deleteWhen</span><span class="token punctuation">=</span><span class="token value attr-value">04</span>
<span class="token comment">#文件保留时间，默认 48 小时</span>
<span class="token key attr-name">fileReservedTime</span><span class="token punctuation">=</span><span class="token value attr-value">120</span>
<span class="token comment">#commitLog每个文件的大小默认1G</span>
<span class="token key attr-name">mapedFileSizeCommitLog</span><span class="token punctuation">=</span><span class="token value attr-value">1073741824</span>
<span class="token comment">#ConsumeQueue每个文件默认存30W条，根据业务情况调整</span>
<span class="token key attr-name">mapedFileSizeConsumeQueue</span><span class="token punctuation">=</span><span class="token value attr-value">300000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_2-2-2-启动broker"><a href="#_2-2-2-启动broker" class="header-anchor">#</a> 2.2.2：启动broker</h3> <p>在bin目录下，新建my-broker.cmd文件，启动内容如下:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>start mqbroker.cmd <span class="token parameter variable">-c</span>  <span class="token punctuation">..</span>/conf/broker.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20210223173822345.1dc93875.png" alt="image-20210223173822345"></p> <p>broker进程jvm堆内存设置</p> <p><img src="/assets/img/image-20210223173957038.20c724aa.png" alt="image-20210223173957038"></p> <p>broker启动成功</p> <p><img src="/assets/img/image-20201109102649221.8c854f06.png" alt="image-20201109102649221"></p> <h1 id="三-rocketmq-进程角色"><a href="#三-rocketmq-进程角色" class="header-anchor">#</a> 三：RocketMQ 进程角色</h1> <h2 id="_3-1-进程角色说明"><a href="#_3-1-进程角色说明" class="header-anchor">#</a> 3.1：进程角色说明</h2> <p><img src="/assets/img/timg.fc6e7fe6.jpg" alt="timg"></p> <ul><li><p>Name Server：在消息队列RocketMQ版中提供命名服务，<strong>更新和发现Broker服务</strong>，<strong>保存broker和topic</strong></p> <p><strong>的路由信息</strong>，Name Server通过集群保证高可用</p></li> <li><p>Broker： 集群最核心模块，主要负责<strong>Topic消息存储、消费者的消费位点管理</strong>（消费进度）。</p> <p>broker通过主备保证分片数据高可用。</p></li></ul> <p><img src="/assets/img/image-20220712062652563.a8a2aa32.png" alt="timg"></p> <h2 id="_3-2-相关概念"><a href="#_3-2-相关概念" class="header-anchor">#</a> 3.2：相关概念</h2> <p><strong>消息（Message）</strong></p> <p>消息系统所传输信息的物理载体，生产和消费数据的最小单位，每条消息必须属于一个主题。RocketMQ中每个消息拥有唯一的<strong>Message ID</strong>，且可以携带具有业务标识的Key。系统提供了通过Message ID和Key查询消息的功能。</p> <p>String  K,V    Hash K,k,v</p> <p><strong>主题（Topic）</strong></p> <p>每条消息只能属于一个主题，是RocketMQ进行消息订阅的基本单位。</p> <p><strong>标签（Tag）</strong></p> <p>为消息设置的标志，用于同一主题下区分不同类型的消息。来自同一业务单元的消息，可以根据不同业务目的在同一主题下设置不同标签。标签能够有效地保持代码的清晰度和连贯性，并优化RocketMQ提供的查询系统。消费者可以根据Tag实现对不同子主题的不同消费逻辑，实现更好的扩展性。</p> <p><strong>生产者组（Producer Group）</strong></p> <p>同一类Producer的集合，这类Producer发送同一类消息且发送逻辑一致。如果发送的是事务消息且原始生产者在发送之后崩溃，则Broker服务器会联系同一生产者组的其他生产者实例以提交或回溯消费。</p> <p><strong>消费者组（Consumer Group）</strong></p> <p>同一类Consumer的集合，这类Consumer通常消费同一类消息且消费逻辑一致。消费者组使得在消息消费方面，实现负载均衡和容错的目标变得非常容易。要注意的是，消费者组的消费者实例必须订阅完全相同的Topic。RocketMQ 支持两种消息模式：集群消费（Clustering）和广播消费（Broadcasting）。</p> <h1 id="四-rocketmq控制台"><a href="#四-rocketmq控制台" class="header-anchor">#</a> 四：RocketMQ控制台</h1> <p><img src="/assets/img/image-20201109082730318.01decac0.png" alt="image-20201109082730318"></p> <blockquote><p><code>RocketMQ</code>有一个对其扩展的开源项目<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这个项目中有一个子模块叫<code>rocketmq-console</code>，这个便是管理控制台项目了，先将<a href="https://github.com/apache/rocketmq-externals" target="_blank" rel="noopener noreferrer">incubator-rocketmq-externals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>拉到本地，因为我们需要自己对<code>rocketmq-console</code>进行编译打包运行。</p></blockquote> <h2 id="_4-1-下载控制台源码"><a href="#_4-1-下载控制台源码" class="header-anchor">#</a> 4.1：下载控制台源码</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 方式一、git下载，执行如下命令</span>
<span class="token function">git</span> clone https://github.com/apache/rocketmq-externals.git

<span class="token comment"># 方式二、直接下载，访问如下地址即可</span>
https://github.com/apache/rocketmq-externals/archive/master.zip

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_4-2-切换rocketmq-console模块"><a href="#_4-2-切换rocketmq-console模块" class="header-anchor">#</a> 4.2：切换rocketmq-console模块</h2> <p>修改端口（rocketmq-console&gt;src&gt;resource&gt;application.properties）</p> <p><img src="/assets/img/image-20210223175936590.e09bbb1c.png" alt="image-20210223175936590"></p> <p>修改nameserver的地址（rocketmq-console&gt;src&gt;resource&gt;application.properties）</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">rocketmq.config.namesrvAddr</span><span class="token punctuation">=</span><span class="token value attr-value">localhost:9876</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20210223180017191.dc34010b.png" alt="image-20210223180017191"></p> <p>修改Rocketmq的api版本（rocketmq-console&gt;pom.xml）</p> <p><img src="/assets/img/image-20201107153436455.f230bbeb.png" alt="image-20201107153436455"></p> <p>添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_4-3-使用maven编译构建"><a href="#_4-3-使用maven编译构建" class="header-anchor">#</a> 4.3：使用maven编译构建</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mvn clean package <span class="token parameter variable">-Dmaven.test.skip</span><span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_4-4-懒人包"><a href="#_4-4-懒人包" class="header-anchor">#</a> 4.4：懒人包</h2> <blockquote><p>如果你不想做上面操作，直接使用资料里面已经打包好的懒人包，启动即可</p></blockquote> <p>RocketMQ     rocketmq-client</p> <p>redis   jedis             Spring Data Redis  StringRedisTemplate</p> <p>es     rest client       Spring Data ElaticSerach  ElaticSearchRestTemplate</p> <h1 id="五-消息收发"><a href="#五-消息收发" class="header-anchor">#</a> 五：消息收发</h1> <p>pom依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- mq java客户端       --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.6.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_5-1-生产者-同步消息"><a href="#_5-1-生产者-同步消息" class="header-anchor">#</a> 5.1：生产者-同步消息</h2> <p>生产者和Broker直接的同步，生产者发送了消息后，如果没有收到Broker的响应，就一直等到超时</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>同步：发送网络请求后会同步等待 Broker 服务器返回结果，支持发送失败重试，适用于比较重要的消息通知场景。

异步：异步发送网络请求，不会阻塞当前线程，支持失败重试，适用于对响应时间要求更高的场景。

单向：单向发送原理和异步一致，但不支持回调。适用于响应时间非常短，对可靠性要求不高的场景，例如日志收集。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>这种可靠性同步地发送方式使用的比较广泛，比如：重要的消息通知，短信通知。</p> <p>send方法阻塞线程</p></blockquote> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>发送消息的步骤
1.创建消息生产者producer(DefaultMQProducer)，并制定生产者group
2.指定Nameserver地址
3.启动producer
4.创建Message对象，指定主题Topic、标签、消息体
5.发送消息
6.关闭生产者producer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//发送消息的步骤</span>
<span class="token comment">//1.创建消息生产者producer(DefaultMQProducer)，并指定生产者group</span>
<span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span>
    <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;test-group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//2.指定Nameserver地址</span>
producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//3.启动producer</span>
 producer<span class="token punctuation">.</span><span class="token function">setSendMsgTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//超时时间</span>
producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//4.创建Message对象，指定主题Topic、消息体</span>
<span class="token class-name">Message</span> message <span class="token operator">=</span>
    <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test0tag&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;你好 MQ!!&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//5.发送消息【同步消息：阻塞线程】</span>
<span class="token class-name">SendResult</span> send <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>send<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//6.关闭生产者producer</span>
producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_5-2-生产者-发异步消息"><a href="#_5-2-生产者-发异步消息" class="header-anchor">#</a> 5.2：生产者-发异步消息</h2> <blockquote><p>异步消息通常用在对响应时间敏感的业务场景，即发送端不能容忍长时间地等待Broker的响应。</p> <p>send方法不阻塞线程，同时还可以异步处理发送结果</p></blockquote> <p>可以设置重试次数 producer.retryTimesWhenSendAsyncFailed(3);   (同步：retryTimesWhenSendFailed)</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>     <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sendYiBu&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sendYiBu</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">RemotingException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">MQBrokerException</span> <span class="token punctuation">{</span>
<span class="token comment">//        发送消息的步骤</span>
<span class="token comment">//        1.创建消息生产者producer(DefaultMQProducer)，并制定生产者group</span>
        <span class="token class-name">DefaultMQProducer</span> defaultMQProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;yibusend-group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        2.指定Nameserver地址</span>
        defaultMQProducer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        3.启动producer</span>
         defaultMQProducer<span class="token punctuation">.</span><span class="token function">setSendMsgTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//超时时间</span>
        defaultMQProducer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        4.创建Message对象，指定主题Topic、消息体</span>
        <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;yibu&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tag1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello,异步消息&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        5.发送消息</span>
        defaultMQProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                defaultMQProducer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>throwable<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="_5-3-生产者-发单向消息"><a href="#_5-3-生产者-发单向消息" class="header-anchor">#</a> 5.3：生产者-发单向消息</h2> <blockquote><p>这种方式主要用在不特别关心发送结果的场景，不关心消息的发送结果，例如日志发送。</p> <p>send方法不会阻塞线程</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">//发送消息的步骤</span>
        <span class="token comment">//1.创建消息生产者producer(DefaultMQProducer)，并指定生产者group名称</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.指定Nameserver地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.启动producer</span>
       defaultMQProducer<span class="token punctuation">.</span><span class="token function">setSendMsgTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//超时时间</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.创建Message对象，指定主题Topic、消息体</span>
        <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test-tag1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;你好  MQ  单向&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.发送消息【单向消息】</span>
        <span class="token comment">//设置mq消息发送的重试次数</span>
        producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendFailed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">sendOneway</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_5-4-消费者-集群模式"><a href="#_5-4-消费者-集群模式" class="header-anchor">#</a> 5.4：消费者-集群模式</h2> <blockquote><p>当有多个消费者同时监听某个topic时，集群模式只允许消息被消费一次，一条具体的消息不会被重复消费,默认行为</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>1.创建消费者Consumer(DefaultMQPushConsumer)，指定消费者组名
2.指定Nameserver地址
3.订阅(subscribe)主题Topic  和 标签
4.设置消费模式(MessageModel),默认集群模式
5.注册（register）回调函数，处理消息
6.启动消费者
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建消费者Consumer(DefaultMQPushConsumer)，指定消费者组名</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;consumer-group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.指定Nameserver地址</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.订阅(subscribe)主题Topic</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test-tag1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.设置消费模式(MessageModel),默认集群模式</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.注册（register）回调函数，处理消息   ，一次取几条消息</span>
        consumer<span class="token punctuation">.</span><span class="token function">setConsumeMessageBatchMaxSize</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> messageExt <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//获取消息的topic</span>
                        <span class="token class-name">String</span> topic <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息的标签</span>
                        <span class="token class-name">String</span> tags <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息内容</span>
                        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageExt<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token operator">+</span>topic<span class="token operator">+</span><span class="token string">&quot;==tags&quot;</span><span class="token operator">+</span>tags<span class="token operator">+</span><span class="token string">&quot;==content&quot;</span><span class="token operator">+</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">RECONSUME_LATER</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>


                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.启动消费者</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="_5-5-消费者-广播模式"><a href="#_5-5-消费者-广播模式" class="header-anchor">#</a> 5.5：消费者-广播模式</h2> <blockquote><p>当有多个消费者同时监听某个topic时，广播模式 消息会被每个消费者同时消费</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建消费者Consumer(DefaultMQPushConsumer)，指定消费者组名</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;consumer-group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.指定Nameserver地址</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.订阅(subscribe)主题Topic</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test-tag1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.设置消费模式(MessageModel),默认集群模式</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">BROADCASTING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.注册（register）回调函数，处理消息</span>
        consumer<span class="token punctuation">.</span><span class="token function">setConsumeMessageBatchMaxSize</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> messageExt <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//获取消息的topic</span>
                        <span class="token class-name">String</span> topic <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息的标签</span>
                        <span class="token class-name">String</span> tags <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息内容</span>
                        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageExt<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token operator">+</span>topic<span class="token operator">+</span><span class="token string">&quot;==tags&quot;</span><span class="token operator">+</span>tags<span class="token operator">+</span><span class="token string">&quot;==content&quot;</span><span class="token operator">+</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">RECONSUME_LATER</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>


                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.启动消费者</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h1 id="六-特殊场景"><a href="#六-特殊场景" class="header-anchor">#</a> 六：特殊场景</h1> <h2 id="_6-1-顺序消息"><a href="#_6-1-顺序消息" class="header-anchor">#</a> 6.1： 顺序消息</h2> <blockquote><p>默认情况下：RocketMQ是没法做到全局有序的，因为一个topic有可能存到多个queue，如下图</p></blockquote> <p>​</p> <p><img src="/assets/img/image-20201107200331954.1296a548.png" alt="image-20201107200331954"></p> <h3 id="_6-1-1-演示topic全局无序"><a href="#_6-1-1-演示topic全局无序" class="header-anchor">#</a> 6.1.1：演示topic全局无序</h3> <p>producer</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//1.创建消息生产者DefaultMQProducer，并制定生产者group</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;producer-group-3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.指定Nameserver地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.启动producer</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//4.构造消息对象</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test-tag3&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//5.发送消息</span>
            <span class="token class-name">SendResult</span> send <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>send<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>consumer</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建消费者Consumer(DefaultMQPushConsumer)，指定消费者组名</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;consumer-group3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.指定Nameserver地址</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.订阅(subscribe)主题Topic</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test-tag3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.设置消费模式(MessageModel),默认负载均衡模式</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.注册（register）回调函数，处理消息</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                 <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> messageExt <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//获取消息的topic</span>
                        <span class="token class-name">String</span> topic <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息的标签</span>
                        <span class="token class-name">String</span> tags <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息内容</span>
                        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageExt<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token operator">+</span>topic<span class="token operator">+</span><span class="token string">&quot;==tags&quot;</span><span class="token operator">+</span>tags<span class="token operator">+</span><span class="token string">&quot;==content&quot;</span><span class="token operator">+</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">RECONSUME_LATER</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>


                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.启动消费者consumer</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_6-1-2-实现全局有序"><a href="#_6-1-2-实现全局有序" class="header-anchor">#</a> 6.1.2：实现全局有序</h3> <p>场景：适用于先到先得的情况</p> <blockquote><p>代码实现思路：保证一个topic存到同一个queue即可，消息往一个queue发送</p></blockquote> <p>producer</p> <blockquote><p>MessageQueueSelector</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token comment">//1.创建消息生产者DefaultMQProducer，并制定生产者group</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;producer-group-4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.指定Nameserver地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.启动producer</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//4.构造消息对象</span>
            <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test-tag4&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//5.发送消息</span>
            <span class="token class-name">SendResult</span> send <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessageQueueSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token class-name">MessageQueue</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageQueue</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
                    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>send<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>consumer</p> <blockquote><p>MessageListenerOrderly</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建消费者Consumer(DefaultMQPushConsumer)，指定消费者组名</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;consumer-group4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.指定Nameserver地址</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.订阅(subscribe)主题Topic</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test-tag4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.设置消费模式(MessageModel),默认负载均衡模式</span>
        consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.注册（register）回调函数，处理消息</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerOrderly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">public</span> <span class="token class-name">ConsumeOrderlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">ConsumeOrderlyContext</span> consumeOrderlyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> messageExt <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//获取消息的topic</span>
                        <span class="token class-name">String</span> topic <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息的标签</span>
                        <span class="token class-name">String</span> tags <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//获取消息内容</span>
                        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageExt<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token operator">+</span>topic<span class="token operator">+</span><span class="token string">&quot;==tags&quot;</span><span class="token operator">+</span>tags<span class="token operator">+</span><span class="token string">&quot;==content&quot;</span><span class="token operator">+</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span><span class="token constant">SUSPEND_CURRENT_QUEUE_A_MOMENT</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>


                <span class="token keyword">return</span> <span class="token class-name">ConsumeOrderlyStatus</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.启动消费者consumer</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_6-1-3-分区有序"><a href="#_6-1-3-分区有序" class="header-anchor">#</a> 6.1.3：分区有序</h3> <p>如奇数放在一个队列0，偶数放在另外队列1</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  public static void main(String[] args) throws MQClientException, RemotingException, InterruptedException, MQBrokerException {
  //        发送消息的步骤
  //        1.创建消息生产者producer(DefaultMQProducer)，并制定生产者group
        DefaultMQProducer producer = new DefaultMQProducer(&quot;myproducer&quot;);
  //        2.指定Nameserver地址
        producer.setNamesrvAddr(&quot;127.0.0.1:9876&quot;);
  //        3.启动producer
        producer.start();
        for(int i=1;i&lt;101;i++){
       //   4.创建Message对象，指定主题Topic、消息体
            Message m = new Message(&quot;mytopic4&quot;,&quot;mytag1&quot;,(&quot;hello consumer!&quot;+i).getBytes());
         // 5.发送消息
            producer.send(m, new MessageQueueSelector() {
                @Override
                public MessageQueue select(List&lt;MessageQueue&gt; list, Message message, Object o) {
                    int queue=0;
                    Integer index = (Integer) o;
                    if(index % 2==0){  // 偶数
                        queue=1;
                    }
                    return list.get(queue);
                }
            },i);
        }
//
//        6.关闭生产者producer
        producer.shutdown();

    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_6-2-延时消息"><a href="#_6-2-延时消息" class="header-anchor">#</a> 6.2： 延时消息</h2> <p><img src="/assets/img/image-20210223134729166.f674a2cd.png" alt="image-20210223134729166"></p> <blockquote><p>应用场景：</p> <p>比如电商里，提交了一个订单就可以发送一个延时消息，1h后去检查这个订单的状态，如果还是未付款就取消订单释放库存。</p></blockquote> <p>​</p> <p>producer</p> <blockquote><p>message.setDelayTimeLevel(3);</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建消息生产者producer(DefaultMQProducer)，并制定生产者group</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">&quot;producer-group-5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.指定Nameserver地址</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.启动producer</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.创建Message对象，指定主题Topic、消息体</span>
        <span class="token class-name">Message</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test-tag5&quot;</span><span class="token comment">/*用于消息过滤*/</span><span class="token punctuation">,</span> <span class="token string">&quot;你好 mq&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</span>
        message<span class="token punctuation">.</span><span class="token function">setDelayTimeLevel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//延时等级   (10S后存，不是16秒)</span>
        <span class="token comment">//5.发送消息</span>
        <span class="token class-name">SendResult</span> send <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>send<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.关闭生产者producer</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>consumer</p> <blockquote><p>消费时间 &gt;消息的发送时间+延时级别</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token comment">//1.创建消费者Consumer(DefaultMQPushConsumer)，指定消费者组名</span>
       <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;consumer-group5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//2.指定Nameserver地址</span>
       consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//3.订阅(subscribe)主题Topic</span>
       consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic5&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test-tag5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//4.设置消费模式(MessageModel),默认集群模式</span>
       consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">BROADCASTING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//5.注册（register）回调函数，处理消息</span>
       consumer<span class="token punctuation">.</span><span class="token function">setConsumeMessageBatchMaxSize</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>

               <span class="token keyword">try</span> <span class="token punctuation">{</span>
                   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> messageExt <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                       <span class="token comment">//获取消息的topic</span>
                       <span class="token class-name">String</span> topic <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                       <span class="token comment">//获取消息的标签</span>
                       <span class="token class-name">String</span> tags <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                       <span class="token comment">//获取消息内容</span>
                       <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageExt<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token operator">+</span>topic<span class="token operator">+</span><span class="token string">&quot;==tags&quot;</span><span class="token operator">+</span>tags<span class="token operator">+</span><span class="token string">&quot;==content&quot;</span><span class="token operator">+</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                       <span class="token comment">//打印演示消费的时间</span>
                       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> messageExt<span class="token punctuation">.</span><span class="token function">getStoreTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span>
               <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                   <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">RECONSUME_LATER</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>


               <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//6.启动消费者</span>
       consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h1 id="七-重试队列"><a href="#七-重试队列" class="header-anchor">#</a> 七：重试队列</h1> <blockquote><p>RocketMQ消费端默认有重试机制</p> <p><strong>面试题</strong></p> <p>**重试队列产生的情况： 1异常重试   2 超时重试  **</p> <p><strong>重试队列名称为</strong>：<strong>%RETRY%+consumergroup</strong></p> <p><strong>默认重试16次</strong></p> <p><strong>重试队列只在集群模式下有效</strong></p></blockquote> <p>消费端重试分为两种情况</p> <ol><li>异常重试：由于Consumer端逻辑出现了异常，导致返回了RECONSUME_LATER状态，那么Broker就会在一段时间后尝试重试。</li> <li>超时重试：如果Consumer端处理时间过长，或者由于某些原因线程挂起，导致迟迟没有返回消费状态，Broker就会认为Consumer消费超时，此时会发起超时重试。</li></ol> <p><strong>重试队列名称为</strong>：%RETRY%+consumergroup</p> <p><strong>设置重试时间与次数：</strong></p> <p>可在broker.conf文件中配置Consumer端的重试次数和重试时间间隔</p> <p>messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</p> <p>默认重试<strong>16</strong>次，默认级别为<strong>level3</strong>,时间间隔为:</p> <p><img src="https://img2022.cnblogs.com/blog/1065530/202208/1065530-20220803215544265-368452329.png" alt="img"></p> <p><strong>异常重试演示：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    <span class="token comment">//1.创建消费者Consumer(DefaultMQPushConsumer)，指定消费者组名</span>
    <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;consumer-group1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2.指定Nameserver地址</span>
    consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9876&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3.订阅(subscribe)主题Topic</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test-tag1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4.设置消费模式(MessageModel),默认集群模式</span>
    consumer<span class="token punctuation">.</span><span class="token function">setMessageModel</span><span class="token punctuation">(</span><span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5.注册（register）回调函数，处理消息</span>
    consumer<span class="token punctuation">.</span><span class="token function">setConsumeMessageBatchMaxSize</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> consumeConcurrentlyContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MessageExt</span> messageExt <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//获取消息的topic</span>
                    <span class="token class-name">String</span> topic <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//获取消息的标签</span>
                    <span class="token class-name">String</span> tags <span class="token operator">=</span> messageExt<span class="token punctuation">.</span><span class="token function">getTags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//获取消息内容</span>
                    <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>messageExt<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;topic&quot;</span><span class="token operator">+</span>topic<span class="token operator">+</span><span class="token string">&quot;==tags&quot;</span><span class="token operator">+</span>tags<span class="token operator">+</span><span class="token string">&quot;==content&quot;</span><span class="token operator">+</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">RECONSUME_LATER</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>



        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//6.启动消费者</span>
    consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><blockquote><p>注意1：只有在消息模式为MessageModel.CLUSTERING集群模式时，Broker才会自动进行重试，广播消息是不会重试的。</p> <p>注意2：由于MQ的重试机制，难免会引起消息的重复消费问题。比如一个ConsumerGroup中有两个，Consumer1和Consumer2，以集群方式消费。假设一条消息发往ConsumerGroup，由Consumer1消费，但是由于Consumer1消费过慢导致超时，如果Broker将消息发送给Consumer2去消费，这样就产生了重复消费问题。因此，使用MQ时应该对一些关键消息进行幂等去重的处理。</p></blockquote> <h1 id="八-死信队列"><a href="#八-死信队列" class="header-anchor">#</a> 八：死信队列</h1> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>当一条消息初次消费失败，消息队列 RocketMQ 版会自动进行消息重试，达到最大重试次数后，若消费依然失败，则表明消费者在正常情况下无法正确地消费该消息。此时，消息队列 RocketMQ 版不会立刻将消息丢弃，而是将其发送到该消费者对应的特殊队列中。

在消息队列 RocketMQ 版中，这种正常情况下无法被消费的消息称为死信消息（Dead-Letter Message），存储死信消息的特殊队列称为死信队列（Dead-Letter Queue）。


死信消息具有以下特性：
1:不会再被消费者正常消费。
2:有效期与正常消息相同，均为 3 天，3 天后会被自动删除。因此，请在死信消息产生后的 3 天内及时处理。


死信队列具有以下特性：
1:一个死信队列对应一个 Group ID， 而不是对应单个消费者实例。
2:如果一个 Group ID 未产生死信消息，消息队列 RocketMQ 版不会为其创建相应的死信队列。
3:一个死信队列包含了对应 Group ID 产生的所有死信消息，不论该消息属于哪个 Topic。
4:消息队列 RocketMQ 版控制台提供对死信消息的查询、重发的功能。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>StringRedisTemplate</p> <p>ElasticSearchRestTemplate</p> <h1 id="九-springboot整合rocketmq"><a href="#九-springboot整合rocketmq" class="header-anchor">#</a> 九：Springboot整合RocketMQ</h1> <h2 id="_9-1-起步依赖"><a href="#_9-1-起步依赖" class="header-anchor">#</a> 9.1：起步依赖</h2> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>rocketmq-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--2.1.0对应的mq是4.6.x--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_9-2-配置"><a href="#_9-2-配置" class="header-anchor">#</a> 9.2：配置</h2> <p>在application.properties里面配置</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#必须配置</span>
<span class="token comment">#指定nameServer</span>
<span class="token key attr-name">rocketmq.name-server</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:9876</span>
<span class="token comment">#指定发送者组名</span>
<span class="token key attr-name">rocketmq.producer.group</span><span class="token punctuation">=</span><span class="token value attr-value">wfx-goods-producer</span>

<span class="token comment">#其他可选配置</span>
<span class="token comment">#发送消息超时时间，单位：毫秒。默认为 3000 。</span>
<span class="token key attr-name">rocketmq.producer.send-message-timeout</span><span class="token punctuation">=</span><span class="token value attr-value">3000</span>
<span class="token comment"># 消息压缩阀值，当消息体的大小超过该阀值后，进行消息压缩。默认为 4 * 1024B</span>
<span class="token key attr-name">rocketmq.producer.compress-message-body-threshold</span><span class="token punctuation">=</span><span class="token value attr-value">4096</span>
<span class="token comment">## 消息体的最大允许大小。。默认为 4 * 1024 * 1024B</span>
<span class="token key attr-name">rocketmq.producer.max-message-size</span><span class="token punctuation">=</span><span class="token value attr-value">4194304</span>
<span class="token comment">#发送消息给 Broker 时，如果发送失败，是否重试另外一台 Broker 。默认为 false</span>
<span class="token key attr-name">rocketmq.producer.retry-next-server</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token comment"># 同步发送消息时，失败重试次数。默认为 2 次。</span>
<span class="token key attr-name">rocketmq.producer.retry-times-when-send-failed</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
<span class="token comment"># 异步发送消息时，失败重试次数。默认为 2 次。</span>
<span class="token key attr-name">rocketmq.producer.retry-times-when-send-async-failed</span><span class="token punctuation">=</span><span class="token value attr-value">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_9-3-发布消息"><a href="#_9-3-发布消息" class="header-anchor">#</a> 9.3：发布消息</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>mq</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>mq<span class="token punctuation">.</span>order<span class="token punctuation">.</span></span><span class="token class-name">IdWorker</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendCallback</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>producer<span class="token punctuation">.</span></span><span class="token class-name">SendResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">MessageBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * &lt;p&gt;title: com.mq&lt;/p&gt;
 * author zhuximing
 * description:
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">{</span>
     

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RocketMQTemplate</span> rocketMQTemplate<span class="token punctuation">;</span>
  

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;syncSend&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">syncSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 同步发送消息</span>
        <span class="token keyword">return</span> rocketMQTemplate<span class="token punctuation">.</span><span class="token function">syncSend</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic1:test-tag1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;你好mq&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;asyncSend&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">asyncSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// 异步发送消息</span>
        rocketMQTemplate<span class="token punctuation">.</span><span class="token function">asyncSend</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic2:test-tag2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;asyncSend&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SendCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">SendResult</span> sendResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  throwable<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;onewaySend&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onewaySend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// oneway 发送消息</span>
        rocketMQTemplate<span class="token punctuation">.</span><span class="token function">sendOneWay</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic3:test-tag3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;oneway&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;delay&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//延时消息</span>
        rocketMQTemplate<span class="token punctuation">.</span><span class="token function">syncSend</span><span class="token punctuation">(</span><span class="token string">&quot;test-topic4:test-tag4&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span><span class="token string">&quot;delay&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token string">&quot;delay&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h2 id="_9-4-监听消息"><a href="#_9-4-监听消息" class="header-anchor">#</a> 9.4：监听消息</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>qf<span class="token punctuation">.</span>listener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ConsumeMode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">MessageModel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RocketMQMessageListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RocketMQMessageListener</span><span class="token punctuation">(</span>consumerGroup <span class="token operator">=</span> <span class="token string">&quot;test-consumer-group-8&quot;</span><span class="token punctuation">,</span>
    topic <span class="token operator">=</span> <span class="token string">&quot;test-topic8&quot;</span><span class="token punctuation">,</span>selectorExpression <span class="token operator">=</span> <span class="token string">&quot;test-tag8&quot;</span><span class="token punctuation">,</span>
    consumeMode <span class="token operator">=</span> <span class="token class-name">ConsumeMode</span><span class="token punctuation">.</span><span class="token constant">CONCURRENTLY</span><span class="token punctuation">,</span>
    messageModel <span class="token operator">=</span> <span class="token class-name">MessageModel</span><span class="token punctuation">.</span><span class="token constant">CLUSTERING</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerListener</span> <span class="token keyword">implements</span> <span class="token class-name">RocketMQListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>


    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h1 id="十-面试题"><a href="#十-面试题" class="header-anchor">#</a> 十：面试题</h1> <p><strong>面试题:</strong></p> <p><strong>异步处理   应用解耦     流量削峰</strong></p> <p><strong>NameServe</strong>: <strong>更新和发现Broker服务</strong>，<strong>保存broker和topic的路由信息</strong></p> <p><strong>Broker:Topic消息存储、消费者的消费位点管理</strong></p> <p><strong>集群模式：一个消息只有一个消费者</strong></p> <p><strong>广播模式:一个消息可以有多个消费者</strong></p> <p><strong>RocketMQ消息：全局无序 （队列个数默认是4，消息是分发到不同队列中）</strong></p> <p><strong>MQ:消息队列</strong></p> <p><strong>常见的MQ： ActiveMQ,RocketMQ,RabbitMQ,Kafka</strong></p> <p><strong>优势:异步处理，应用解耦 ，流量削峰</strong></p> <p><strong>Name Server和Broker的关系?</strong></p> <p><strong>Name Server：更新和发现Broker服务，保存broker和topic的路由关系</strong></p> <p><strong>Broker:Topic消息存储、消费者的消费位点管理</strong></p> <p><strong>集群模式和广播模式的区别?</strong></p> <p><strong>集群模式下：消息只能被一个消费者消费一次</strong></p> <p><strong>广播模式下：消息可以被多个消费者消费</strong></p> <p><strong>为什么全局无序？</strong></p> <p><strong>消息默认会发送不同的队列中，所以是全局无序</strong></p> <p><strong>如何做到全局有序？</strong></p> <p><strong>发送消息时指定特定队列</strong></p> <p>**重试队列产生的情况： 1异常重试   2 超时重试  **</p> <p><strong>重试队列名称为</strong>：<strong>%RETRY%+consumergroup</strong></p> <p><strong>默认重试16次 ,默认等级是3</strong></p> <p><strong>重试队列只在集群模式下有效</strong></p> <p><strong>消息超过重试次数后，不会立即被删除，而是进入到死信队列中，3天后被删除，可以通过控制台重发</strong></p> <p><strong>面试题：消息发送怎么解决0丢失的问题？</strong>    ！！！重点</p> <p>答：生产者在发送消息的时候，可以设置重试次数，发送失败默认重试2次</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendFailed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同步发送</span>
 producer<span class="token punctuation">.</span><span class="token function">setRetryTimesWhenSendAsyncFailed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//异步发送</span>
同步消息重发会选择其它的broker，异步消息不会选择其它broker重发，存在消息丢失的问题
单向消息不会进行重发  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>面试题：怎么保证消息消费的时候0丢失？</strong>   ! ! !重点</p> <p>答：Rocketmq默认就有重试队列机制，如果第一次消费的时候，broker收到的回应是（ConsumeConcurrentlyStatus.RECONSUME_LATER），那么这条消息不会丢失，会进入重试队列，重试的次数与重试的时间可以配置(broker的配置文件中)，如果重试的次数超过配置的次数，那么这条消息没有丢失，但是放入死信队列</p> <p><strong>面试题：怎么解决消费幂等问题？</strong> ！！！重点</p> <p>什么是消息的消费幂等</p> <p>同一个消息被成功地处理多次</p> <p>答：处理办法，幂等令牌以及唯一性处理</p> <ul><li><p>幂等令牌：通常指具备唯一业务标识的字符串。例如，订单号、流水号。一般由Producer随着消息一同发送来的。</p></li> <li><p>唯一性处理：保证同一个业务逻辑不会被重复执行成功多次。例如，对同一笔订单的多次支付操作，只会成功一次。</p> <p>解决方案如：用Redis分布式锁 setIfAbsent       setnx  name zhangsan</p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2024/6/14</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/中间件/redis/布隆过滤器.html" class="prev">
          布隆过滤器
        </a></span> <span class="next"><a href="/中间件/rocketMq/rocketMq深入.html">
          RocketMQ深入理解
        </a>
        →
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">RocketMQ入门</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-1-什么是mq-message-queue-消息队列" class="toc-sidebar-link">1.1：什么是MQ     (Message Queue 消息队列)</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-2-mq的优势" class="toc-sidebar-link">1.2：MQ的优势</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-3-主流mq对比" class="toc-sidebar-link">1.3：主流MQ对比</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-4-apache-rocketmq简介" class="toc-sidebar-link">1.4：Apache RocketMQ简介</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-1-配置并启动nameserver进程" class="toc-sidebar-link">2.1：配置并启动nameserver进程</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-1-1-配置nameserver" class="toc-sidebar-link">2.1.1：配置nameserver</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-1-2-启动nameserver" class="toc-sidebar-link">2.1.2：启动nameserver</a></li></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-2-配置并启动broker进程" class="toc-sidebar-link">2.2：配置并启动broker进程</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-2-1-配置broker" class="toc-sidebar-link">2.2.1：配置broker</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-2-2-启动broker" class="toc-sidebar-link">2.2.2：启动broker</a></li></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_3-1-进程角色说明" class="toc-sidebar-link">3.1：进程角色说明</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_3-2-相关概念" class="toc-sidebar-link">3.2：相关概念</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-1-下载控制台源码" class="toc-sidebar-link">4.1：下载控制台源码</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-2-切换rocketmq-console模块" class="toc-sidebar-link">4.2：切换rocketmq-console模块</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-3-使用maven编译构建" class="toc-sidebar-link">4.3：使用maven编译构建</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-4-懒人包" class="toc-sidebar-link">4.4：懒人包</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-1-生产者-同步消息" class="toc-sidebar-link">5.1：生产者-同步消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-2-生产者-发异步消息" class="toc-sidebar-link">5.2：生产者-发异步消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-3-生产者-发单向消息" class="toc-sidebar-link">5.3：生产者-发单向消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-4-消费者-集群模式" class="toc-sidebar-link">5.4：消费者-集群模式</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-5-消费者-广播模式" class="toc-sidebar-link">5.5：消费者-广播模式</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-顺序消息" class="toc-sidebar-link">6.1： 顺序消息</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-1-演示topic全局无序" class="toc-sidebar-link">6.1.1：演示topic全局无序</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-2-实现全局有序" class="toc-sidebar-link">6.1.2：实现全局有序</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-3-分区有序" class="toc-sidebar-link">6.1.3：分区有序</a></li></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-2-延时消息" class="toc-sidebar-link">6.2： 延时消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-1-起步依赖" class="toc-sidebar-link">9.1：起步依赖</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-2-配置" class="toc-sidebar-link">9.2：配置</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-3-发布消息" class="toc-sidebar-link">9.3：发布消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-4-监听消息" class="toc-sidebar-link">9.4：监听消息</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">RocketMQ入门</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-1-什么是mq-message-queue-消息队列" class="toc-sidebar-link">1.1：什么是MQ     (Message Queue 消息队列)</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-2-mq的优势" class="toc-sidebar-link">1.2：MQ的优势</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-3-主流mq对比" class="toc-sidebar-link">1.3：主流MQ对比</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_1-4-apache-rocketmq简介" class="toc-sidebar-link">1.4：Apache RocketMQ简介</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-1-配置并启动nameserver进程" class="toc-sidebar-link">2.1：配置并启动nameserver进程</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-1-1-配置nameserver" class="toc-sidebar-link">2.1.1：配置nameserver</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-1-2-启动nameserver" class="toc-sidebar-link">2.1.2：启动nameserver</a></li></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-2-配置并启动broker进程" class="toc-sidebar-link">2.2：配置并启动broker进程</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-2-1-配置broker" class="toc-sidebar-link">2.2.1：配置broker</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_2-2-2-启动broker" class="toc-sidebar-link">2.2.2：启动broker</a></li></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_3-1-进程角色说明" class="toc-sidebar-link">3.1：进程角色说明</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_3-2-相关概念" class="toc-sidebar-link">3.2：相关概念</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-1-下载控制台源码" class="toc-sidebar-link">4.1：下载控制台源码</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-2-切换rocketmq-console模块" class="toc-sidebar-link">4.2：切换rocketmq-console模块</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-3-使用maven编译构建" class="toc-sidebar-link">4.3：使用maven编译构建</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_4-4-懒人包" class="toc-sidebar-link">4.4：懒人包</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-1-生产者-同步消息" class="toc-sidebar-link">5.1：生产者-同步消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-2-生产者-发异步消息" class="toc-sidebar-link">5.2：生产者-发异步消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-3-生产者-发单向消息" class="toc-sidebar-link">5.3：生产者-发单向消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-4-消费者-集群模式" class="toc-sidebar-link">5.4：消费者-集群模式</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_5-5-消费者-广播模式" class="toc-sidebar-link">5.5：消费者-广播模式</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-顺序消息" class="toc-sidebar-link">6.1： 顺序消息</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-1-演示topic全局无序" class="toc-sidebar-link">6.1.1：演示topic全局无序</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-2-实现全局有序" class="toc-sidebar-link">6.1.2：实现全局有序</a></li><li class="toc-sidebar-sub-header"><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-1-3-分区有序" class="toc-sidebar-link">6.1.3：分区有序</a></li></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_6-2-延时消息" class="toc-sidebar-link">6.2： 延时消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-1-起步依赖" class="toc-sidebar-link">9.1：起步依赖</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-2-配置" class="toc-sidebar-link">9.2：配置</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-3-发布消息" class="toc-sidebar-link">9.3：发布消息</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html#_9-4-监听消息" class="toc-sidebar-link">9.4：监听消息</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/wechat.png" class="nozoom"> <span class="show-txt">手机看</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">微信扫一扫</span> <img height="180px" src="https://api.qrserver.com/v1/create-qr-code/?data=https://tec.hjcwzx.top/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketMq/RocketMQ.html" style="margin:10px;">
                可以<b>手机看</b>或分享至<b>朋友圈</b></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <div class="option-box"><img src="/images/system/xingqiu.png" width="25px" class="nozoom"> <span class="show-txt">星球</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><img height="180px" src="/images/personal/xingqiu.png" style="margin:10px;"> <b>知识星球</b>：技术侦探
            </div></div></div></div> <div class="option-box"><img src="/images/system/wexin4.png" width="25px" class="nozoom"> <span class="show-txt">交流</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">添加微信一起学习交流</span> <img src="/images/personal/weixin.png" height="180px" style="margin:10px;">
                PS：添加时请备注<b>技术侦探</b>，谢谢！
              </div></div></div></div> <div class="option-box"><img src="/images/system/heart-1.png" width="25px" class="nozoom"> <span class="show-txt">支持我</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">鼓励/支持/赞赏我</span> <img height="180px" src="/images/personal/encourage-head.png" style="margin:5px;"> <br>1. 不靠它生存但仍希望得到你的鼓励；
                <br>2. 时刻警醒自己保持技术人的初心，沉淀，分享，成长；
              </div></div></div></div> <div title="布隆过滤器" class="option-box" style="padding-left:2px;text-align:center;"><a href="/中间件/redis/布隆过滤器.html"><img src="/images/system/pre2.png" width="30px" class="nozoom"> <span class="show-txt">上一篇</span></a></div> <div title="RocketMQ深入理解" class="option-box" style="padding-left:2px;text-align:center;"><a href="/中间件/rocketMq/rocketMq深入.html"><img src="/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">下一篇</span></a></div></div>  <div class="page-side-sitemap"><div class="option-box"><img src="/images/system/sitemap.png" class="nozoom img"> <span class="show-txt">站点图</span> <div class="sitemap-container"><h4>站点导航图
              <a href="/更新日志/更新日志.html" class="sitemap-top-link"> 更新日志</a></h4> <table class="sitemap-table"><tr><td nowrap="nowrap"><div class="sitemap-col-group">常用搜索</div></td> <td><div class="sitemap-col-item"><a href="http://www.baidu.com/" target="_blank" title="百度">
          百度
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.google.com/" target="_blank" title="Google">
          Google
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.bing.com/" target="_blank" title="Bing">
          Bing
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://github.com" target="_blank" title="Github">
          Github
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.programcreek.com/java-api-examples/index.php" target="_blank" title="搜代码">
          搜代码
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">技术社区</div></td> <td><div class="sitemap-col-item"><a href="http://www.csdn.net/" target="_blank" title="CDSN">
          CDSN
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.cnblogs.com/" target="_blank" title="博客园">
          博客园
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.oschina.net" target="_blank" title="OSChina">
          OSChina
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://segmentfault.com/" target="_blank" title="思否">
          思否
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://juejin.im" target="_blank" title="掘金">
          掘金
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.linuxidc.com/" target="_blank" title="Linux公社">
          Linux公社
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.ibm.com/developerworks/cn/" target="_blank" title="IBM 开发者">
          IBM 开发者
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://stackoverflow.com" target="_blank" title="StackOverflow">
          StackOverflow
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">Java相关</div></td> <!----> <td><a href="/java/javaSE基础/01_Java入门与开发环境搭建.html" class="sitemap-col-item">
          JavaSE基础
        </a><a href="/java/JavaSE高级/01_IO.html" class="sitemap-col-item">
          JavaSE高级
        </a><a href="/java/javaWeb/01_Web开发基础.html" class="sitemap-col-item">
          JavaWeb
        </a><a href="/java/JUC/1、JUC概述.html" class="sitemap-col-item">
          JUC
        </a><a href="/java/补充/JVM.html" class="sitemap-col-item">
          JVM
        </a><a href="/java/补充/枚举.html" class="sitemap-col-item">
          ENUM
        </a><a href="/java/补充/线程池.html" class="sitemap-col-item">
          线程池
        </a><a href="/java/补充/自定义注解.html" class="sitemap-col-item">
          自定义注解
        </a><a href="/java/响应式编程/前置知识.html" class="sitemap-col-item">
          响应式编程
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">Spring</div></td> <!----> <td><a href="/框架/Mybatis/01_MyBatis快速入门.html" class="sitemap-col-item">
          Mybatis
        </a><a href="/框架/Mybatis/03_MybatisPlus.html" class="sitemap-col-item">
          Mybatis Plus
        </a><a href="/框架/Spring全家桶/Spring/01_SpringIOC和DI.html" class="sitemap-col-item">
          Spring
        </a><a href="/框架/Spring全家桶/SpringMVC/01_SpringMVC快速入门及解析.html" class="sitemap-col-item">
          Spring MVC
        </a><a href="/框架/Spring全家桶/SpringBoot/01_SpringBoot_入门.html" class="sitemap-col-item">
          Spring Boot
        </a><a href="/框架/Spring全家桶/SpringCloudAlibaba/Nacos.html" class="sitemap-col-item">
          Spring Cloud Alibaba
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">中间件&amp;插件</div></td> <!----> <td><a href="/中间件/maven/01_Maven基础.html" class="sitemap-col-item">
          Maven中央仓库
        </a><a href="/中间件/ElasticSearch/ElasticSearch.html" class="sitemap-col-item">
          ElasticSearch
        </a><a href="/中间件/redis/Redis笔记全.html" class="sitemap-col-item">
          Redis
        </a><a href="/中间件/redis/布隆过滤器.html" class="sitemap-col-item">
          布隆过滤器
        </a><a href="/中间件/rocketMq/RocketMQ.html" class="sitemap-col-item">
          RocketMQ.
        </a><a href="/中间件/git/笔记.html" class="sitemap-col-item">
          git
        </a><a href="/中间件/自定义Starter/自定义starter.html" class="sitemap-col-item">
          自定义starter
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">运维</div></td> <!----> <td><a href="/部署/nginx/Nginx.html" class="sitemap-col-item">
          Nginx
        </a><a href="/部署/docker/docker.html" class="sitemap-col-item">
          Docker
        </a><a href="/部署/linux/01_Linux_安装.html" class="sitemap-col-item">
          Linux
        </a><a href="/部署/vm/linux安装centos.html" class="sitemap-col-item">
          VM Ware
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">面向对象</div></td> <!----> <td><a href="/设计模式/创建型模式/" class="sitemap-col-item">
          设计模式
        </a></td></tr></table></div></div></div> <!----> </aside></div><div class="global-ui"><div class="read-more-wrap" style="display:none;position:absolute;bottom:0px;z-index:9999;width:100%;margin-top:-100px;font-family:PingFangSC-Regular, sans-serif;"><div id="read-more-mask" style="position: relative; height: 200px; background: -webkit-gradient(linear, 0 0%, 0 100%, from(rgba(255, 255, 255, 0)), to(rgb(255, 255, 255)));"></div> <a id="read-more-btn" target="_self" style="position: absolute; left: 50%; top: 70%; bottom: 30px;\n        transform: translate(-50%, -50%); width: 160px; height: 36px;\n         line-height: 36px; font-size: 15px; text-align: center;\n          border: 1px solid rgb(222, 104, 109); color: rgb(222, 104, 109);\n           background: rgb(255, 255, 255); cursor: pointer; border-radius: 6px;">阅读全文</a> <div id="btw-modal-wrap" style="display: none;"><div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0);"></div> <div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;"><span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 34px; font-size: 34px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">×</span> <p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px;">
            微信扫码或搜索：<span style="color: #E9405A; font-weight: bold;">智慧对话的未来</span> <br>发送：<span id="hutec-token" class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">}</span> <br>即可<span style="color: #e9415a; font-weight: bold;">立即永久</span>解锁本站全部文章</p> <img src="/images/personal/qrcode.png" style="width: 180px; margin-top: 10px; margin-bottom: 30px; border: 8px solid rgb(230, 230, 230);"></div></div></div></div></div>
    <script src="/assets/js/cg-styles.js?v=1718536766705" defer></script><script src="/assets/js/cg-4.js?v=1718536766705" defer></script><script src="/assets/js/cg-28.js?v=1718536766705" defer></script><script src="/assets/js/cg-1.js?v=1718536766705" defer></script><script src="/assets/js/cg-88.js?v=1718536766705" defer></script><script src="/assets/js/cg-app.js?v=1718536766705" defer></script>
  </body>
</html>
