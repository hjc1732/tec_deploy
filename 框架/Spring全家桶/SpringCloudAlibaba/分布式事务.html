<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Seata | 技术侦探</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script charset="utf-8" async="async" src="https://s9.cnzz.com/z_stat.php?id=1278232949&amp;web_id=1278232949"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?0b31b4c146bf7126aed5009e1a4a11c8";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="技术并不是我们所追求的目的,而是技术创新世界">
    <meta property="article:modified_time" content="null">
    <meta property="og:title" content="Seata">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html">
    <meta name="twitter:title" content="Seata">
    <meta name="twitter:url" content="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="小傅哥">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="Java基础">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.ee4e0787.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1718345273160" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1718345273160" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1718345273160" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1718345273160" as="script"><link rel="preload" href="/assets/js/cg-34.js?v=1718345273160" as="script"><link rel="preload" href="/assets/js/cg-1.js?v=1718345273160" as="script"><link rel="preload" href="/assets/js/cg-85.js?v=1718345273160" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.ee4e0787.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1718345273160">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">技术侦探</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/javaSE基础/01_Java入门与开发环境搭建.html" class="nav-link">
  javaSE
</a></li><li class="dropdown-subitem"><a href="/java/javaWeb/01_Web开发基础.html" class="nav-link">
  javaWeb
</a></li><li class="dropdown-subitem"><a href="/java/JUC/1、JUC概述.html" class="nav-link">
  JUC
</a></li><li class="dropdown-subitem"><a href="/java/响应式编程/前置知识.html" class="nav-link">
  响应式编程
</a></li><li class="dropdown-subitem"><a href="/设计模式/概述/概述.html" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/jdbc/01_JDBC.html" class="nav-link">
  jdbc
</a></li><li class="dropdown-subitem"><a href="/db/mysql/Mysql基础/01_MySQL概述.html" class="nav-link">
  mysql
</a></li></ul></li><li class="dropdown-item"><h4>
          补充
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/补充/Retrofit2.html" class="nav-link">
  Retrofit2
</a></li><li class="dropdown-subitem"><a href="/java/补充/rxJava/rxJava.html" class="nav-link">
  rxJava
</a></li><li class="dropdown-subitem"><a href="/java/补充/lua.html" class="nav-link">
  lua
</a></li><li class="dropdown-subitem"><a href="/java/补充/JVM.html" class="nav-link">
  jvm
</a></li><li class="dropdown-subitem"><a href="/java/补充/枚举.html" class="nav-link">
  枚举
</a></li><li class="dropdown-subitem"><a href="/java/补充/线程池.html" class="nav-link">
  线程池
</a></li><li class="dropdown-subitem"><a href="/java/补充/自定义注解.html" class="nav-link">
  自定义注解
</a></li></ul></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端/前端基础/01_HTML.html" class="nav-link">
  前端基础
</a></li><li class="dropdown-subitem"><a href="/前端/vue/01_ECMAScript6入门.html" class="nav-link">
  vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/框架/DDD架构/01-ddd是什么.html" class="nav-link">
  DDD
</a></li><li class="dropdown-item"><!----> <a href="/框架/Mybatis/01_MyBatis快速入门.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><h4>
          Spring全家桶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/框架/Spring全家桶/Spring/01_SpringIOC和DI.html" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringMVC/01_SpringMVC快速入门及解析.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringBoot/01_SpringBoot_入门.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringSecurity/SpringSecurity.html" class="nav-link">
  SpringSecurity
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringCloudAlibaba/Nacos.html" class="nav-link">
  SpringCloudAlibaba
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/中间件/ElasticSearch/ElasticSearch.html" class="nav-link">
  中间件 | 自研轮子
</a></div><div class="nav-item"><a href="/部署/linux/01_Linux_安装.html" class="nav-link">
  部署|运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/实战/商城/项目笔记.html" class="nav-link">
  锋迷铺子
</a></li><li class="dropdown-item"><!----> <a href="/实战/实用工具类/DocUtils.html" class="nav-link">
  实用工具类
</a></li><li class="dropdown-item"><!----> <a href="http://520.hjcwzx.top/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  研究生工作平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/更新日志/更新日志.html" class="nav-link">
  更新日志
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/javaSE基础/01_Java入门与开发环境搭建.html" class="nav-link">
  javaSE
</a></li><li class="dropdown-subitem"><a href="/java/javaWeb/01_Web开发基础.html" class="nav-link">
  javaWeb
</a></li><li class="dropdown-subitem"><a href="/java/JUC/1、JUC概述.html" class="nav-link">
  JUC
</a></li><li class="dropdown-subitem"><a href="/java/响应式编程/前置知识.html" class="nav-link">
  响应式编程
</a></li><li class="dropdown-subitem"><a href="/设计模式/概述/概述.html" class="nav-link">
  设计模式
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/jdbc/01_JDBC.html" class="nav-link">
  jdbc
</a></li><li class="dropdown-subitem"><a href="/db/mysql/Mysql基础/01_MySQL概述.html" class="nav-link">
  mysql
</a></li></ul></li><li class="dropdown-item"><h4>
          补充
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/补充/Retrofit2.html" class="nav-link">
  Retrofit2
</a></li><li class="dropdown-subitem"><a href="/java/补充/rxJava/rxJava.html" class="nav-link">
  rxJava
</a></li><li class="dropdown-subitem"><a href="/java/补充/lua.html" class="nav-link">
  lua
</a></li><li class="dropdown-subitem"><a href="/java/补充/JVM.html" class="nav-link">
  jvm
</a></li><li class="dropdown-subitem"><a href="/java/补充/枚举.html" class="nav-link">
  枚举
</a></li><li class="dropdown-subitem"><a href="/java/补充/线程池.html" class="nav-link">
  线程池
</a></li><li class="dropdown-subitem"><a href="/java/补充/自定义注解.html" class="nav-link">
  自定义注解
</a></li></ul></li><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/前端/前端基础/01_HTML.html" class="nav-link">
  前端基础
</a></li><li class="dropdown-subitem"><a href="/前端/vue/01_ECMAScript6入门.html" class="nav-link">
  vue
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/框架/DDD架构/01-ddd是什么.html" class="nav-link">
  DDD
</a></li><li class="dropdown-item"><!----> <a href="/框架/Mybatis/01_MyBatis快速入门.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><h4>
          Spring全家桶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/框架/Spring全家桶/Spring/01_SpringIOC和DI.html" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringMVC/01_SpringMVC快速入门及解析.html" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringBoot/01_SpringBoot_入门.html" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringSecurity/SpringSecurity.html" class="nav-link">
  SpringSecurity
</a></li><li class="dropdown-subitem"><a href="/框架/Spring全家桶/SpringCloudAlibaba/Nacos.html" class="nav-link">
  SpringCloudAlibaba
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/中间件/ElasticSearch/ElasticSearch.html" class="nav-link">
  中间件 | 自研轮子
</a></div><div class="nav-item"><a href="/部署/linux/01_Linux_安装.html" class="nav-link">
  部署|运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><span class="title">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/实战/商城/项目笔记.html" class="nav-link">
  锋迷铺子
</a></li><li class="dropdown-item"><!----> <a href="/实战/实用工具类/DocUtils.html" class="nav-link">
  实用工具类
</a></li><li class="dropdown-item"><!----> <a href="http://520.hjcwzx.top/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  研究生工作平台
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/更新日志/更新日志.html" class="nav-link">
  更新日志
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>服务中心</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/框架/Spring全家桶/SpringCloudAlibaba/Nacos.html" class="sidebar-link">Nacos</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>网关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/框架/Spring全家桶/SpringCloudAlibaba/SpringCloud-Gateway.html" class="sidebar-link">GateWay</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>流控</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/框架/Spring全家桶/SpringCloudAlibaba/Sentinel.html" class="sidebar-link">Sentinel</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>链路追踪</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/框架/Spring全家桶/SpringCloudAlibaba/Sleuth.html" class="sidebar-link">Sleuth</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>分布式事务</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/框架/Spring全家桶/SpringCloudAlibaba/分布式事务.html" class="active sidebar-link">Seata</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h1 id="seata"><a href="#seata" class="header-anchor">#</a> Seata</h1> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>小结：
nacos 【name server】：注册中心，解决服务的注册与发现
nacos【config】：配置中心，微服务配置文件的中心化管理，同时配置信息的动态刷新
Ribbon：客户端负载均衡器，解决微服务集群负载均衡的问题
Openfeign：声明式HTTP客户端，解决微服务之间远程调用问题
Sentinel：微服务流量防卫兵,以流量为入口，保护微服务，防止服务雪崩
gateway：微服务网关，服务集群的入口，路由转发以及负载均衡（全局认证、流控）
sleuth:链路追踪
seata:分布式事务解决方案
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>面试：</strong></p> <p><strong>1：什么是分布式事务</strong></p> <p>​    <strong>分布式系统中，跨连接的事务</strong></p> <p><strong>2：怎么解决分布式事务？ seata</strong></p> <p><strong>3：seata分布式事务的工作流程/原理/机制</strong></p> <p><strong>TM：事务管理器 ，标注了@GlobalTransational的方法就受TM的管理，开启全局事务，发起全局事务的提交， 或回滚</strong></p> <p><strong>TC: Seata 服务器，事务协调器 ，接收TM的指令，向RM传达指令，生成全局事务ID</strong> <strong>RM：Seata 客户端，资源管理器</strong> <strong>一阶段提交：解析和执行sql语句，需要获取全局锁，获取前后镜像存放到undo_log表</strong> <strong>二阶段提交：删除undo_log表记录 ，释放全局锁<br>
二阶段回滚：执行sql语句数据恢复，删除undo_log表记录 ，释放全局锁</strong></p> <p><strong>4：seata全局事务并发隔离如何实现？</strong></p> <p><strong>（1） 全局锁可以保证写隔离，拿不到全局锁，不能提交分支事务</strong></p> <p><strong>（2）读加锁（select for update） 可以保证读隔离，避免脏读</strong></p> <h1 id="一-分布式事务简介"><a href="#一-分布式事务简介" class="header-anchor">#</a> 一：分布式事务简介</h1> <h3 id="_1-1-本地事务"><a href="#_1-1-本地事务" class="header-anchor">#</a> 1.1：本地事务</h3> <blockquote><p>单服务进程，单数据库资源,同一个连接conn多个事务操作</p></blockquote> <p><img src="/assets/img/image-20201111202522896.cdb99e62.png" alt="image-20201111202522896"></p> <p>在JDBC编程中，我们通过<code>java.sql.Connection</code>对象来开启、关闭或者提交事务。代码如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">//获取数据库连接</span>
conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//开启事务</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token comment">//1:张三-100 conn1</span>
    <span class="token comment">//2:李四+100 conn2 </span>
    <span class="token comment">//3.其他操作10/0</span>
    conn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//提交事务</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    conn<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//事务回滚</span>
<span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭链接</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Spring声明式事务（基于aop实现）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>   <span class="token comment">/**
     * @param fromUserName 转账人
     * @param toUserName 被转账人
     * @param changeSal 转账额度
     */</span>
    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeSal</span><span class="token punctuation">(</span><span class="token class-name">String</span> fromUserName<span class="token punctuation">,</span><span class="token class-name">String</span> toUserName<span class="token punctuation">,</span><span class="token keyword">int</span> changeSal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        bankMapper<span class="token punctuation">.</span><span class="token function">updateSal</span><span class="token punctuation">(</span>fromUserName<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> changeSal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bankMapper<span class="token punctuation">.</span><span class="token function">updateSal</span><span class="token punctuation">(</span>toUserName<span class="token punctuation">,</span> changeSal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_1-2-分布式事务"><a href="#_1-2-分布式事务" class="header-anchor">#</a> 1.2：分布式事务</h3> <p><img src="/assets/img/image-20220722095639065.be40ec2d.png" alt="image-20220722095639065"></p> <h3 id="_1-3-分布式事务问题复现"><a href="#_1-3-分布式事务问题复现" class="header-anchor">#</a> 1.3：分布式事务问题复现</h3> <blockquote><p>模拟下单需求</p> <p>1：cloud-order服务：提交订单（tb_order insert）</p> <p>2：cloud-goods服务：扣减库存(tb_goods update) api</p></blockquote> <p>entity</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;tb_goods&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TbGoods</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
        * 
        */</span>
            <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">ASSIGN_ID</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> goodsId<span class="token punctuation">;</span>
        <span class="token comment">/**
        * 
        */</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> goodsStock<span class="token punctuation">;</span>
        <span class="token comment">/**
        * 
        */</span>
        <span class="token keyword">private</span> <span class="token class-name">Double</span> goodsPrice<span class="token punctuation">;</span>
        <span class="token comment">/**
        * 
        */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> goodsName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;tb_order&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TbOrder</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     *
     */</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span><span class="token constant">ASSIGN_ID</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderId<span class="token punctuation">;</span>
    <span class="token comment">/**
     *
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> orderNum<span class="token punctuation">;</span>
    <span class="token comment">/**
     *
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> orderAmount<span class="token punctuation">;</span>
    <span class="token comment">/**
     *
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> goodsId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--    mysql驱动    --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.49<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--   druid     --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

   
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
      <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/cloud_demo<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;useSSL=false</span>
      <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">40</span> <span class="token comment">#连接池配置</span>
<span class="token comment">#输出sql语句</span>
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>模拟下单： 在qf-cloud-orders订单模块存入订单信息到tb_order，feign远程调用qf-clouds-goods商品模块更新商品库存（tb_goods update）</p> <h1 id="二-seata简介"><a href="#二-seata简介" class="header-anchor">#</a> 二：Seata简介</h1> <blockquote><p>Seata(Simple Extensible Autonomous Transaction Architecture) 是 阿里巴巴开源的分布式事务中间件，以高效并且对业务 0 侵入的方式，解决微服务场景下面临的分布式事务问题。</p></blockquote> <p>github地址：https://github.com/seata/seata</p> <p>中文官网：http://seata.io/zh-cn/</p> <h2 id="_2-1-at模式角色分析"><a href="#_2-1-at模式角色分析" class="header-anchor">#</a> 2.1：AT模式角色分析</h2> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>Transaction Coordinator(TC): Maintain status of global and branch transactions, drive the global commit or rollback.

Transaction Manager(TM): Define the scope of global transaction: begin a global transaction, commit or rollback a global transaction.

Resource Manager(RM): Manage resources that branch transactions working on, talk to TC for registering branch transactions and reporting status of branch transactions, and drive the branch transaction commit or rollback.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>Transaction Coordinator (TC)： 事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚</li> <li>Transaction Manager ™：事务管理器， 控制全局事务的边界 ，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议</li> <li>Resource Manager (RM)： 资源管理器，控制分支事务，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支（本地）事务的提交和回滚</li></ol> <h2 id="_2-2-at模式工作流程"><a href="#_2-2-at模式工作流程" class="header-anchor">#</a> 2.2：AT模式工作流程</h2> <p><img src="/assets/img/image-20220722144252808.c191e1f3.png" alt="image-20220722144252808"></p> <p><img src="/assets/img/image-20220722144238142.e0f675d8.png" alt="image-20220722144238142"></p> <h1 id="三-seata应用"><a href="#三-seata应用" class="header-anchor">#</a> 三：Seata应用</h1> <h2 id="_3-1-下载seata-server"><a href="#_3-1-下载seata-server" class="header-anchor">#</a> 3.1：下载seata-server</h2> <p>下载地址：<a href="https://github.com/seata/seata/tags" target="_blank" rel="noopener noreferrer">Tags · seata/seata · GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_3-2-配置seata-server"><a href="#_3-2-配置seata-server" class="header-anchor">#</a> 3.2：配置Seata-server</h2> <h3 id="_3-2-1-配置seata-server数据源"><a href="#_3-2-1-配置seata-server数据源" class="header-anchor">#</a> 3.2.1：配置seata-server数据源</h3> <p>E:\seata-server-1.4.2\seata\seata-server-1.4.2\conf\file.conf</p> <p><img src="/assets/img/image-20210807120507747.36667dc0.png" alt="image-20210807120507747"></p> <h3 id="_3-2-2-创建seata数据库"><a href="#_3-2-2-创建seata数据库" class="header-anchor">#</a> 3.2.2：创建seata数据库</h3> <blockquote><p>create database seata</p></blockquote> <h3 id="_3-2-3-创建3张表"><a href="#_3-2-3-创建3张表" class="header-anchor">#</a> 3.2.3：创建3张表</h3> <p>表的脚本下载地址：https://github.com/seata/seata/tree/develop/script/server/db</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- -------------------------------- The script used when storeMode is 'db' --------------------------------</span>
<span class="token comment">-- the table to store GlobalSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>global_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>                       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>            <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>                    <span class="token keyword">TINYINT</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_id<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_service_group<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_name<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>timeout<span class="token punctuation">`</span></span>                   <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>begin_time<span class="token punctuation">`</span></span>                <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>          <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>                <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>              <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_gmt_modified_status<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_transaction_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment">-- the table to store BranchSession data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>branch_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>         <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>               <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span>    <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_group_id<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_type<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span>            <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span>         <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>application_data<span class="token punctuation">`</span></span>  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>        <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>      <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_xid<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>

<span class="token comment">-- the table to store lock data</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>lock_table<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span>        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>            <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>transaction_id<span class="token punctuation">`</span></span> <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>      <span class="token keyword">BIGINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>resource_id<span class="token punctuation">`</span></span>    <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>table_name<span class="token punctuation">`</span></span>     <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>pk<span class="token punctuation">`</span></span>             <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_create<span class="token punctuation">`</span></span>     <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>gmt_modified<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>row_key<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_branch_id<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="_3-2-4-修改seata的注册中心"><a href="#_3-2-4-修改seata的注册中心" class="header-anchor">#</a> 3.2.4：修改seata的注册中心</h3> <p>E:\seata-server-1.4.2\seata\seata-server-1.4.2\conf\registry.conf</p> <p><img src="/assets/img/image-20210807120733657.f2c5c96d.png" alt="image-20210807120733657"></p> <h3 id="_3-2-5-修改seata-server的配置中心"><a href="#_3-2-5-修改seata-server的配置中心" class="header-anchor">#</a> 3.2.5：修改seata-server的配置中心</h3> <p>E:\seata-server-1.4.2\seata\seata-server-1.4.2\conf\registry.conf</p> <p><img src="/assets/img/image-20210807120822629.7e45cba0.png" alt="image-20210807120822629"></p> <h3 id="_3-2-6-nacos配置中心管理seata配置"><a href="#_3-2-6-nacos配置中心管理seata配置" class="header-anchor">#</a> 3.2.6：Nacos配置中心管理seata配置</h3> <h4 id="_3-2-6-1-下载配置项"><a href="#_3-2-6-1-下载配置项" class="header-anchor">#</a> 3.2.6.1：下载配置项</h4> <p>https://github.com/seata/seata/tree/develop/script/config-center</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>transport.type=TCP

transport.server=NIO

transport.heartbeat=true

transport.enableClientBatchSendRequest=false

transport.threadFactory.bossThreadPrefix=NettyBoss

transport.threadFactory.workerThreadPrefix=NettyServerNIOWorker

transport.threadFactory.serverExecutorThreadPrefix=NettyServerBizHandler

transport.threadFactory.shareBossWorker=false

transport.threadFactory.clientSelectorThreadPrefix=NettyClientSelector

transport.threadFactory.clientSelectorThreadSize=1

transport.threadFactory.clientWorkerThreadPrefix=NettyClientWorkerThread

transport.threadFactory.bossThreadSize=1

transport.threadFactory.workerThreadSize=default

transport.shutdown.wait=3

service.vgroupMapping.fengmi_tx_group=default

service.default.grouplist=127.0.0.1:8091

service.enableDegrade=false

service.disableGlobalTransaction=false

client.rm.asyncCommitBufferLimit=10000

client.rm.lock.retryInterval=10

client.rm.lock.retryTimes=30

client.rm.lock.retryPolicyBranchRollbackOnConflict=true

client.rm.reportRetryCount=5

client.rm.tableMetaCheckEnable=false

client.rm.tableMetaCheckerInterval=60000

client.rm.sqlParserType=druid

client.rm.reportSuccessEnable=false

client.rm.sagaBranchRegisterEnable=false

client.tm.commitRetryCount=5

client.tm.rollbackRetryCount=5

client.tm.defaultGlobalTransactionTimeout=60000

client.tm.degradeCheck=false

client.tm.degradeCheckAllowTimes=10

client.tm.degradeCheckPeriod=2000

store.mode=db

store.publicKey=

store.file.dir=file_store/data

store.file.maxBranchSessionSize=16384

store.file.maxGlobalSessionSize=512

store.file.fileWriteBufferCacheSize=16384

store.file.flushDiskMode=async

store.file.sessionReloadReadSize=100

store.db.datasource=druid

store.db.dbType=mysql

store.db.driverClassName=com.mysql.jdbc.Driver
store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true
store.db.user=root
store.db.password=123456

store.db.minConn=5

store.db.maxConn=30

store.db.globalTable=global_table

store.db.branchTable=branch_table

store.db.queryLimit=100

store.db.lockTable=lock_table

store.db.maxWait=5000

store.redis.mode=single

store.redis.single.host=127.0.0.1

store.redis.single.port=6379

store.redis.maxConn=10

store.redis.minConn=1

store.redis.maxTotal=100

store.redis.database=0

store.redis.password=

store.redis.queryLimit=100

server.recovery.committingRetryPeriod=1000

server.recovery.asynCommittingRetryPeriod=1000

server.recovery.rollbackingRetryPeriod=1000

server.recovery.timeoutRetryPeriod=1000

server.maxCommitRetryTimeout=-1

server.maxRollbackRetryTimeout=-1

server.rollbackRetryTimeoutUnlockEnable=false

client.undo.dataValidation=true

client.undo.logSerialization=jackson

client.undo.onlyCareUpdateColumns=true

server.undo.logSaveDays=7

server.undo.logDeletePeriod=86400000

client.undo.logTable=undo_log

client.undo.compress.enable=true

client.undo.compress.type=zip

client.undo.compress.threshold=64k

log.exceptionRate=100

transport.serialization=seata

transport.compressor=none

metrics.enabled=false

metrics.registryType=compact

metrics.exporterList=prometheus

metrics.exporterPrometheusPort=9898
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br></div></div><h4 id="_3-2-6-2-修改相关配置项"><a href="#_3-2-6-2-修改相关配置项" class="header-anchor">#</a> 3.2.6.2：修改相关配置项</h4> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>service.vgroupMapping.fengmi_tx_group=default     #忽略
store.mode=db
store.db.driverClassName=com.mysql.jdbc.Driver
store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true
store.db.user=root
store.db.password=root    # 只需要改密码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_3-2-6-3-创建配置文件"><a href="#_3-2-6-3-创建配置文件" class="header-anchor">#</a> 3.2.6.3：创建配置文件</h4> <p><img src="/assets/img/image-20210807121432276.bdee0094.png" alt="image-20210807121432276"></p> <p>注意目前只支持properties，不支持yml</p> <p><img src="/assets/img/image-20210807121627526.64ad76a4.png" alt="image-20210807121627526"></p> <h3 id="_3-2-7-启动seata-server"><a href="#_3-2-7-启动seata-server" class="header-anchor">#</a> 3.2.7：启动seata-server</h3> <blockquote><p>注意 -h必须指定为局域网真实ip地址，不要指定127.0.0.1</p></blockquote> <p><img src="data:image/png;base64,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" alt="image-20220722143710226"></p> <blockquote><p>seata-server.bat -h 10.30.162.78 -p 8898</p></blockquote> <h2 id="_3-3-seata客户端"><a href="#_3-3-seata客户端" class="header-anchor">#</a> 3.3：Seata客户端</h2> <blockquote><p>一个调用链中的所有微服务都是seata的客户端，都必须走下面的步骤</p></blockquote> <h3 id="_3-3-1-创建undo-log表"><a href="#_3-3-1-创建undo-log表" class="header-anchor">#</a> 3.3.1：创建undo_log表</h3> <p>下载地址：https://github.com/seata/seata/tree/develop/script/client/at/db</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>undo_log<span class="token punctuation">`</span></span>

<span class="token punctuation">(</span>

    <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span>     <span class="token keyword">BIGINT</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>   <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'branch transaction id'</span><span class="token punctuation">,</span>

    <span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span>           <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'global transaction id'</span><span class="token punctuation">,</span>

    <span class="token identifier"><span class="token punctuation">`</span>context<span class="token punctuation">`</span></span>       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'undo_log context,such as serialization'</span><span class="token punctuation">,</span>

    <span class="token identifier"><span class="token punctuation">`</span>rollback_info<span class="token punctuation">`</span></span> <span class="token keyword">LONGBLOB</span>     <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'rollback info'</span><span class="token punctuation">,</span>

    <span class="token identifier"><span class="token punctuation">`</span>log_status<span class="token punctuation">`</span></span>    <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'0:normal status,1:defense status'</span><span class="token punctuation">,</span>

    <span class="token identifier"><span class="token punctuation">`</span>log_created<span class="token punctuation">`</span></span>   <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'create datetime'</span><span class="token punctuation">,</span>

    <span class="token identifier"><span class="token punctuation">`</span>log_modified<span class="token punctuation">`</span></span>  <span class="token keyword">DATETIME</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'modify datetime'</span><span class="token punctuation">,</span>

    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ux_undo_log<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>xid<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>branch_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>

<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>

  <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span>

  <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COMMENT</span> <span class="token operator">=</span><span class="token string">'AT transaction mode undo table'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_3-3-2-pom依赖"><a href="#_3-3-2-pom依赖" class="header-anchor">#</a> 3.3.2：pom依赖</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- seata --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>seata-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_3-3-3-配置"><a href="#_3-3-3-配置" class="header-anchor">#</a> 3.3.3：配置</h3> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> fengmi_tx_group
  <span class="token key atrule">enable-auto-data-source-proxy</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span> qfgroup
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">data-id</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>seataserver.properties

  <span class="token key atrule">registry</span><span class="token punctuation">:</span> <span class="token comment">#发现seata-server</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
      <span class="token key atrule">group</span><span class="token punctuation">:</span> qfgroup
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_3-3-4-globaltransational"><a href="#_3-3-4-globaltransational" class="header-anchor">#</a> 3.3.4：@Globaltransational</h3> <p><img src="/assets/img/image-20201113160742772.6620fdff.png" alt="image-20201113160742772"></p> <h1 id="四-seata全局事务并发怎么隔离"><a href="#四-seata全局事务并发怎么隔离" class="header-anchor">#</a> 四：Seata全局事务并发怎么隔离</h1> <blockquote><p><strong>1 全局锁可以保证写隔离，拿不到全局锁，不能提交分支事务</strong></p> <p><strong>2 读加锁（select for update） 可以保证读隔离，避免脏读</strong></p></blockquote> <h2 id="写隔离"><a href="#写隔离" class="header-anchor">#</a> 写隔离</h2> <blockquote><ul><li>一阶段本地事务提交前，需要确保先拿到 <strong>全局锁</strong> 。</li> <li>拿不到 <strong>全局锁</strong> ，不能提交本地事务。</li></ul></blockquote> <h2 id="读隔离"><a href="#读隔离" class="header-anchor">#</a> 读隔离</h2> <blockquote><p>一个全局事务修改数据，另外一个全局读取数据怎么解决脏读</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>在数据库本地事务隔离级别 读已提交（Read Committed） 或以上的基础上，Seata（AT 模式）的默认全局隔离级别是 读未提交（Read Uncommitted） 。
如果应用在特定场景下，必需要求全局的 读已提交 ，目前 Seata 的方式是通过 SELECT FOR UPDATE 语句的代理。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>面试：</strong></p> <p><strong>1：什么是分布式事务</strong></p> <p>​    <strong>分布式系统中，跨连接的事务</strong></p> <p><strong>2：怎么解决分布式事务？ seata</strong></p> <p><strong>3：seata分布式事务的工作流程/原理/机制</strong></p> <p><strong>TM：事务管理器 ，标注了@GlobalTransational的方法就受TM的管理，开启全局事务，发起全局事务的提交， 或回滚</strong></p> <p><strong>TC: Seata 服务器，事务协调器 ，接收TM的指令，向RM传达指令，生成全局事务ID</strong> <strong>RM：Seata 客户端，资源管理器</strong> <strong>一阶段提交：解析和执行sql语句，需要获取全局锁，获取前后镜像存放到undo_log表</strong> <strong>二阶段提交：删除undo_log表记录 ，释放全局锁<br>
二阶段回滚：执行sql语句数据恢复，删除undo_log表记录 ，释放全局锁</strong></p> <p><strong>4：seata全局事务并发隔离如何实现？</strong></p> <p><strong>（1） 全局锁可以保证写隔离，拿不到全局锁，不能提交分支事务</strong></p> <p><strong>（2）读加锁（select for update） 可以保证读隔离，避免脏读</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2024/4/13</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/框架/Spring全家桶/SpringCloudAlibaba/Sleuth.html" class="prev">
          Sleuth
        </a></span> <!----></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">Seata</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_2-1-at模式角色分析" class="toc-sidebar-link">2.1：AT模式角色分析</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_2-2-at模式工作流程" class="toc-sidebar-link">2.2：AT模式工作流程</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-1-下载seata-server" class="toc-sidebar-link">3.1：下载seata-server</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-配置seata-server" class="toc-sidebar-link">3.2：配置Seata-server</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-1-配置seata-server数据源" class="toc-sidebar-link">3.2.1：配置seata-server数据源</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-2-创建seata数据库" class="toc-sidebar-link">3.2.2：创建seata数据库</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-3-创建3张表" class="toc-sidebar-link">3.2.3：创建3张表</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-4-修改seata的注册中心" class="toc-sidebar-link">3.2.4：修改seata的注册中心</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-5-修改seata-server的配置中心" class="toc-sidebar-link">3.2.5：修改seata-server的配置中心</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-6-nacos配置中心管理seata配置" class="toc-sidebar-link">3.2.6：Nacos配置中心管理seata配置</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-7-启动seata-server" class="toc-sidebar-link">3.2.7：启动seata-server</a></li></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-seata客户端" class="toc-sidebar-link">3.3：Seata客户端</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-1-创建undo-log表" class="toc-sidebar-link">3.3.1：创建undo_log表</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-2-pom依赖" class="toc-sidebar-link">3.3.2：pom依赖</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-3-配置" class="toc-sidebar-link">3.3.3：配置</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-4-globaltransational" class="toc-sidebar-link">3.3.4：@Globaltransational</a></li></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#写隔离" class="toc-sidebar-link">写隔离</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#读隔离" class="toc-sidebar-link">读隔离</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">Seata</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_2-1-at模式角色分析" class="toc-sidebar-link">2.1：AT模式角色分析</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_2-2-at模式工作流程" class="toc-sidebar-link">2.2：AT模式工作流程</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-1-下载seata-server" class="toc-sidebar-link">3.1：下载seata-server</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-配置seata-server" class="toc-sidebar-link">3.2：配置Seata-server</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-1-配置seata-server数据源" class="toc-sidebar-link">3.2.1：配置seata-server数据源</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-2-创建seata数据库" class="toc-sidebar-link">3.2.2：创建seata数据库</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-3-创建3张表" class="toc-sidebar-link">3.2.3：创建3张表</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-4-修改seata的注册中心" class="toc-sidebar-link">3.2.4：修改seata的注册中心</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-5-修改seata-server的配置中心" class="toc-sidebar-link">3.2.5：修改seata-server的配置中心</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-6-nacos配置中心管理seata配置" class="toc-sidebar-link">3.2.6：Nacos配置中心管理seata配置</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-2-7-启动seata-server" class="toc-sidebar-link">3.2.7：启动seata-server</a></li></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-seata客户端" class="toc-sidebar-link">3.3：Seata客户端</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-1-创建undo-log表" class="toc-sidebar-link">3.3.1：创建undo_log表</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-2-pom依赖" class="toc-sidebar-link">3.3.2：pom依赖</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-3-配置" class="toc-sidebar-link">3.3.3：配置</a></li><li class="toc-sidebar-sub-header"><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#_3-3-4-globaltransational" class="toc-sidebar-link">3.3.4：@Globaltransational</a></li></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#写隔离" class="toc-sidebar-link">写隔离</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html#读隔离" class="toc-sidebar-link">读隔离</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/wechat.png" class="nozoom"> <span class="show-txt">手机看</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">微信扫一扫</span> <img height="180px" src="https://api.qrserver.com/v1/create-qr-code/?data=https://tec.hjcwzx.top/%E6%A1%86%E6%9E%B6/Spring%E5%85%A8%E5%AE%B6%E6%A1%B6/SpringCloudAlibaba/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html" style="margin:10px;">
                可以<b>手机看</b>或分享至<b>朋友圈</b></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <div class="option-box"><img src="/images/system/xingqiu.png" width="25px" class="nozoom"> <span class="show-txt">星球</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><img height="180px" src="/images/personal/xingqiu.png" style="margin:10px;"> <b>知识星球</b>：技术侦探
            </div></div></div></div> <div class="option-box"><img src="/images/system/wexin4.png" width="25px" class="nozoom"> <span class="show-txt">交流</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">添加微信一起学习交流</span> <img src="/images/personal/weixin.png" height="180px" style="margin:10px;">
                PS：添加时请备注<b>技术侦探</b>，谢谢！
              </div></div></div></div> <div class="option-box"><img src="/images/system/heart-1.png" width="25px" class="nozoom"> <span class="show-txt">支持我</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">鼓励/支持/赞赏我</span> <img height="180px" src="/images/personal/encourage-head.png" style="margin:5px;"> <br>1. 不靠它生存但仍希望得到你的鼓励；
                <br>2. 时刻警醒自己保持技术人的初心，沉淀，分享，成长；
              </div></div></div></div> <div title="Sleuth" class="option-box" style="padding-left:2px;text-align:center;"><a href="/框架/Spring全家桶/SpringCloudAlibaba/Sleuth.html"><img src="/images/system/pre2.png" width="30px" class="nozoom"> <span class="show-txt">上一篇</span></a></div> <!----></div>  <div class="page-side-sitemap"><div class="option-box"><img src="/images/system/sitemap.png" class="nozoom img"> <span class="show-txt">站点图</span> <div class="sitemap-container"><h4>站点导航图
              <a href="/更新日志/更新日志.html" class="sitemap-top-link"> 更新日志</a></h4> <table class="sitemap-table"><tr><td nowrap="nowrap"><div class="sitemap-col-group">常用搜索</div></td> <td><div class="sitemap-col-item"><a href="http://www.baidu.com/" target="_blank" title="百度">
          百度
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.google.com/" target="_blank" title="Google">
          Google
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.bing.com/" target="_blank" title="Bing">
          Bing
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://github.com" target="_blank" title="Github">
          Github
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.programcreek.com/java-api-examples/index.php" target="_blank" title="搜代码">
          搜代码
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">技术社区</div></td> <td><div class="sitemap-col-item"><a href="http://www.csdn.net/" target="_blank" title="CDSN">
          CDSN
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.cnblogs.com/" target="_blank" title="博客园">
          博客园
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.oschina.net" target="_blank" title="OSChina">
          OSChina
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://segmentfault.com/" target="_blank" title="思否">
          思否
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://juejin.im" target="_blank" title="掘金">
          掘金
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.linuxidc.com/" target="_blank" title="Linux公社">
          Linux公社
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.ibm.com/developerworks/cn/" target="_blank" title="IBM 开发者">
          IBM 开发者
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://stackoverflow.com" target="_blank" title="StackOverflow">
          StackOverflow
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">Java相关</div></td> <!----> <td><a href="/java/javaSE基础/01_Java入门与开发环境搭建.html" class="sitemap-col-item">
          JavaSE基础
        </a><a href="/java/JavaSE高级/01_IO.html" class="sitemap-col-item">
          JavaSE高级
        </a><a href="/java/javaWeb/01_Web开发基础.html" class="sitemap-col-item">
          JavaWeb
        </a><a href="/java/JUC/1、JUC概述.html" class="sitemap-col-item">
          JUC
        </a><a href="/java/补充/JVM.html" class="sitemap-col-item">
          JVM
        </a><a href="/java/补充/枚举.html" class="sitemap-col-item">
          ENUM
        </a><a href="/java/补充/线程池.html" class="sitemap-col-item">
          线程池
        </a><a href="/java/补充/自定义注解.html" class="sitemap-col-item">
          自定义注解
        </a><a href="/java/响应式编程/前置知识.html" class="sitemap-col-item">
          响应式编程
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">Spring</div></td> <!----> <td><a href="/框架/Mybatis/01_MyBatis快速入门.html" class="sitemap-col-item">
          Mybatis
        </a><a href="/框架/Mybatis/03_MybatisPlus.html" class="sitemap-col-item">
          Mybatis Plus
        </a><a href="/框架/Spring全家桶/Spring/01_SpringIOC和DI.html" class="sitemap-col-item">
          Spring
        </a><a href="/框架/Spring全家桶/SpringMVC/01_SpringMVC快速入门及解析.html" class="sitemap-col-item">
          Spring MVC
        </a><a href="/框架/Spring全家桶/SpringBoot/01_SpringBoot_入门.html" class="sitemap-col-item">
          Spring Boot
        </a><a href="/框架/Spring全家桶/SpringCloudAlibaba/Nacos.html" class="sitemap-col-item">
          Spring Cloud Alibaba
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">中间件&amp;插件</div></td> <!----> <td><a href="/中间件/maven/01_Maven基础.html" class="sitemap-col-item">
          Maven中央仓库
        </a><a href="/中间件/ElasticSearch/ElasticSearch.html" class="sitemap-col-item">
          ElasticSearch
        </a><a href="/中间件/redis/Redis笔记全.html" class="sitemap-col-item">
          Redis
        </a><a href="/中间件/redis/布隆过滤器.html" class="sitemap-col-item">
          布隆过滤器
        </a><a href="/中间件/rocketMq/RocketMQ.html" class="sitemap-col-item">
          RocketMQ.
        </a><a href="/中间件/git/笔记.html" class="sitemap-col-item">
          git
        </a><a href="/中间件/自定义Starter/自定义starter.html" class="sitemap-col-item">
          自定义starter
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">运维</div></td> <!----> <td><a href="/部署/nginx/Nginx.html" class="sitemap-col-item">
          Nginx
        </a><a href="/部署/docker/docker.html" class="sitemap-col-item">
          Docker
        </a><a href="/部署/linux/01_Linux_安装.html" class="sitemap-col-item">
          Linux
        </a><a href="/部署/vm/linux安装centos.html" class="sitemap-col-item">
          VM Ware
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">面向对象</div></td> <!----> <td><a href="/设计模式/创建型模式/" class="sitemap-col-item">
          设计模式
        </a></td></tr></table></div></div></div> <!----> </aside></div><div class="global-ui"><div class="read-more-wrap" style="display:none;position:absolute;bottom:0px;z-index:9999;width:100%;margin-top:-100px;font-family:PingFangSC-Regular, sans-serif;"><div id="read-more-mask" style="position: relative; height: 200px; background: -webkit-gradient(linear, 0 0%, 0 100%, from(rgba(255, 255, 255, 0)), to(rgb(255, 255, 255)));"></div> <a id="read-more-btn" target="_self" style="position: absolute; left: 50%; top: 70%; bottom: 30px;\n        transform: translate(-50%, -50%); width: 160px; height: 36px;\n         line-height: 36px; font-size: 15px; text-align: center;\n          border: 1px solid rgb(222, 104, 109); color: rgb(222, 104, 109);\n           background: rgb(255, 255, 255); cursor: pointer; border-radius: 6px;">阅读全文</a> <div id="btw-modal-wrap" style="display: none;"><div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0);"></div> <div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;"><span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 34px; font-size: 34px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">×</span> <p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px;">
            微信扫码或搜索：<span style="color: #E9405A; font-weight: bold;">智慧对话的未来</span> <br>发送：<span id="hutec-token" class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">}</span> <br>即可<span style="color: #e9415a; font-weight: bold;">立即永久</span>解锁本站全部文章</p> <img src="/images/personal/qrcode.png" style="width: 180px; margin-top: 10px; margin-bottom: 30px; border: 8px solid rgb(230, 230, 230);"></div></div></div></div></div>
    <script src="/assets/js/cg-styles.js?v=1718345273160" defer></script><script src="/assets/js/cg-4.js?v=1718345273160" defer></script><script src="/assets/js/cg-34.js?v=1718345273160" defer></script><script src="/assets/js/cg-1.js?v=1718345273160" defer></script><script src="/assets/js/cg-85.js?v=1718345273160" defer></script><script src="/assets/js/cg-app.js?v=1718345273160" defer></script>
  </body>
</html>
